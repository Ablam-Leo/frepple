<?xml version="1.0" encoding="UTF-8" ?>
<plan xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <name>Test model for fixed flows</name>
  <description>
  This test verifies the solver behavior with flows with batch quantities:
    - case 1: Simple transfer batch of quantity 100 between two production steps.
    - case 2: Same as 1, but with 0-time operations.
    - case 3: Same as 1, and adding an availability calendar.
    - case 4: Consume in batches, while producing at end.
    - case 5: Consume at start, while producing in batches.
    - TODO case 6: Same as 1, but now producing batches of 200 and consuming batches of 100. 
    - TODO case 7: Same as 1, but now producing batches of 100 and consuming batches of 200. 
  </description>
  <current>2018-01-01T00:00:00</current>

  <!--
    Case 1: Simple transfer batch of quantity 100 for the material consumption
    and production between two production steps.
  -->
  <items>
    <item name="1. component">
	    <itemsuppliers>
	      <itemsupplier>
          <supplier name="1. my personal supplier" />
          <leadtime>P40D</leadtime>
          <priority>1</priority>
        </itemsupplier>
	    </itemsuppliers>
    </item>
  </items>
  <operations>
    <operation name="1. make end item" xsi:type="operation_time_per">
      <item name="1. end item"/>
      <location name="plant"/>
      <flows>
        <flow xsi:type="flow_end">
          <item name="1. end item"/>
          <quantity>1</quantity>
        </flow>
        <flow xsi:type="flow_transfer_batch">
          <item name="1. subassembly"/>
          <quantity>-1</quantity>
          <transferbatch>100</transferbatch>
        </flow>
      </flows>
      <loads>
        <load>
          <resource name="1. assembly line"/>
          <quantity>1</quantity>
        </load>
      </loads>
      <size_minimum>200</size_minimum>
      <duration_per>PT10M</duration_per>
    </operation>
    <operation name="1. make subassembly" xsi:type="operation_time_per">
      <item name="1. subassembly"/>
      <location name="plant"/>
      <flows>
        <flow xsi:type="flow_transfer_batch">
          <item name="1. subassembly"/>
          <quantity>1</quantity>
          <transferbatch>100</transferbatch>
        </flow>
        <flow xsi:type="flow_transfer_batch">
          <item name="1. component"/>
          <quantity>-1</quantity>
          <transferbatch>100</transferbatch>
        </flow>
      </flows>
      <loads>
        <load>
          <resource name="1. operator"/>
          <quantity>1</quantity>
        </load>
      </loads>
      <size_minimum>200</size_minimum>
      <duration_per>PT10M</duration_per>
    </operation>
  </operations>
  <demands>
    <demand name="1. order 1">
      <quantity>990</quantity>
      <due>2018-02-01T00:00:00</due>
      <item name="1. end item"/>
      <location name="plant"/>
    </demand>
  </demands>

  <!--
    Case 2: Same as first case, but the total operation time is now 0.
  -->
  <items>
    <item name="2. component">
	    <itemsuppliers>
	      <itemsupplier>
          <supplier name="2. my personal supplier" />
          <leadtime>P40D</leadtime>
          <priority>1</priority>
        </itemsupplier>
	    </itemsuppliers>
    </item>
  </items>
  <operations>
    <operation name="2. make end item" xsi:type="operation_time_per">
      <item name="2. end item"/>
      <location name="plant"/>
      <flows>
        <flow xsi:type="flow_end">
          <item name="2. end item"/>
          <quantity>1</quantity>
        </flow>
        <flow xsi:type="flow_transfer_batch">
          <item name="2. subassembly"/>
          <quantity>-1</quantity>
          <transferbatch>100</transferbatch>
        </flow>
      </flows>
      <loads>
        <load>
          <resource name="2. assembly line"/>
          <quantity>1</quantity>
        </load>
      </loads>
      <duration_per>PT0M</duration_per>
    </operation>
    <operation name="2. make subassembly" xsi:type="operation_time_per">
      <item name="2. subassembly"/>
      <location name="plant"/>
      <flows>
        <flow xsi:type="flow_transfer_batch">
          <item name="2. subassembly"/>
          <quantity>1</quantity>
          <transferbatch>100</transferbatch>
        </flow>
        <flow xsi:type="flow_transfer_batch">
          <item name="2. component"/>
          <quantity>-1</quantity>
          <transferbatch>100</transferbatch>
        </flow>
      </flows>
      <loads>
        <load>
          <resource name="2. operator"/>
          <quantity>1</quantity>
        </load>
      </loads>
      <duration_per>PT0M</duration_per>
    </operation>
  </operations>
  <demands>
    <demand name="2. order 1">
      <quantity>990</quantity>
      <due>2018-02-01T00:00:00</due>
      <item name="2. end item"/>
      <location name="plant"/>
    </demand>
  </demands>

  <!--
    Case 3: Same as 1, but now adding some availability calendars.
  -->
  <locations>
    <location name="plant 3">
      <available name="calendar of site 1">
        <default>0</default>
		<buckets>
		  <!-- 2 + 4 + 8 + 16 + 32 = 62 = effective monday through friday -->
		  <bucket start="2017-01-02T00:00:00" end="2025-01-01T00:00:00" days="62" value="1" />
		</buckets>
      </available>
    </location>
  </locations>
  <items>
    <item name="3. component">
	    <itemsuppliers>
	      <itemsupplier>
          <supplier name="3. my personal supplier" />
          <leadtime>P40D</leadtime>
          <priority>1</priority>
        </itemsupplier>
	    </itemsuppliers>
    </item>
  </items>
  <operations>
    <operation name="3. make end item" xsi:type="operation_time_per">
      <item name="3. end item"/>
      <location name="plant 3"/>
      <flows>
        <flow xsi:type="flow_end">
          <item name="3. end item"/>
          <quantity>1</quantity>
        </flow>
        <flow xsi:type="flow_transfer_batch">
          <item name="3. subassembly"/>
          <quantity>-1</quantity>
          <transferbatch>100</transferbatch>
        </flow>
      </flows>
      <loads>
        <load>
          <resource name="3. assembly line"/>
          <quantity>1</quantity>
        </load>
      </loads>
      <size_minimum>200</size_minimum>
      <duration_per>PT10M</duration_per>
    </operation>
    <operation name="3. make subassembly" xsi:type="operation_time_per">
      <item name="3. subassembly"/>
      <location name="plant 3"/>
      <flows>
        <flow xsi:type="flow_transfer_batch">
          <item name="3. subassembly"/>
          <quantity>1</quantity>
          <transferbatch>100</transferbatch>
        </flow>
        <flow xsi:type="flow_transfer_batch">
          <item name="3. component"/>
          <quantity>-1</quantity>
          <transferbatch>100</transferbatch>
        </flow>
      </flows>
      <loads>
        <load>
          <resource name="3. operator"/>
          <quantity>1</quantity>
        </load>
      </loads>
      <size_minimum>200</size_minimum>
      <duration_per>PT10M</duration_per>
    </operation>
  </operations>
  <demands>
    <demand name="3. order 1">
      <quantity>990</quantity>
      <due>2018-02-01T00:00:00</due>
      <item name="3. end item"/>
      <location name="plant 3"/>
    </demand>
  </demands>
  
  <!--
    Case 4: Consume in batches, while producing at end.
  -->
  <items>
    <item name="4. component">
	    <itemsuppliers>
	      <itemsupplier>
          <supplier name="4. my personal supplier" />
          <leadtime>P40D</leadtime>
          <priority>1</priority>
        </itemsupplier>
	    </itemsuppliers>
    </item>
  </items>
  <operations>
    <operation name="4. make end item" xsi:type="operation_time_per">      
      <item name="4. end item"/>
      <location name="plant"/>
      <flows>
        <flow xsi:type="flow_end">
          <item name="4. end item"/>
          <quantity>1</quantity>
        </flow>
        <flow xsi:type="flow_transfer_batch">
          <item name="4. subassembly"/>
          <quantity>-1</quantity>
          <transferbatch>100</transferbatch>
        </flow>
      </flows>
      <loads>
        <load>
          <resource name="4. assembly line"/>
          <quantity>1</quantity>
        </load>
      </loads>
      <size_minimum>200</size_minimum>    
      <duration_per>PT10M</duration_per>
    </operation>
    <operation name="4. make subassembly" xsi:type="operation_time_per">      
      <item name="4. subassembly"/>
      <location name="plant"/>
      <flows>
        <flow xsi:type="flow_end">
          <item name="4. subassembly"/>
          <quantity>1</quantity>
        </flow>
        <flow xsi:type="flow_transfer_batch">
          <item name="4. component"/>
          <quantity>-1</quantity>
          <transferbatch>100</transferbatch>
        </flow>
      </flows>
      <loads>
        <load>
          <resource name="4. operator"/>
          <quantity>1</quantity>
        </load>
      </loads>
      <size_minimum>200</size_minimum>
      <duration_per>PT10M</duration_per>
    </operation>
  </operations>
  <demands>
    <demand name="4. order 1">
      <quantity>990</quantity>
      <minshipment>990</minshipment>
      <due>2018-02-01T00:00:00</due>
      <item name="4. end item"/>
      <location name="plant"/>
    </demand>
  </demands>
  
  <!--
    Case 5: Consume at start, while producing in batches.
  -->
  <items>
    <item name="5. component">
	    <itemsuppliers>
	      <itemsupplier>
          <supplier name="5. my personal supplier" />
          <leadtime>P40D</leadtime>
          <priority>1</priority>
        </itemsupplier>
	    </itemsuppliers>
    </item>
  </items>
  <operations>
    <operation name="5. make end item" xsi:type="operation_time_per">      
      <item name="5. end item"/>
      <location name="plant"/>
      <flows>
        <flow xsi:type="flow_end">
          <item name="5. end item"/>
          <quantity>1</quantity>
        </flow>
        <flow xsi:type="flow_start">
          <item name="5. subassembly"/>
          <quantity>-1</quantity>
        </flow>
      </flows>
      <loads>
        <load>
          <resource name="5. assembly line"/>
          <quantity>1</quantity>
        </load>
      </loads>      
      <size_minimum>200</size_minimum>
      <duration_per>PT10M</duration_per>
    </operation>
    <operation name="5. make subassembly" xsi:type="operation_time_per">
      <item name="5. subassembly"/>
      <location name="plant"/>
      <flows>
        <flow xsi:type="flow_transfer_batch">
          <item name="5. subassembly"/>
          <quantity>1</quantity>
          <transferbatch>100</transferbatch>
        </flow>
        <flow xsi:type="flow_transfer_batch">
          <item name="5. component"/>
          <quantity>-1</quantity>
          <transferbatch>100</transferbatch>
        </flow>
      </flows>
      <loads>
        <load>
          <resource name="5. operator"/>
          <quantity>1</quantity>
        </load>
      </loads>
      <size_minimum>200</size_minimum>
      <duration_per>PT10M</duration_per>
    </operation>
  </operations>
  <demands>
    <demand name="5. order 1">
      <quantity>990</quantity>
      <!--minshipment>990</minshipment-->
      <due>2018-02-01T00:00:00</due>
      <item name="5. end item"/>
      <location name="plant"/>
    </demand>
  </demands>
    
<?python
from datetime import timedelta
print("CREATING CONSTRAINED PLAN")
frepple.solver_mrp(plantype=1, constraints=15, loglevel=2).solve()
frepple.saveplan("output.1.xml")
print("CREATING UNCONSTRAINED PLAN")
frepple.solver_mrp(plantype=2, constraints=15, loglevel=2).solve()
frepple.saveplan("output.2.xml")
?>

</plan>
