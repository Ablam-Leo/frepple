/* frePPLe 4.0.0
Copyright (C) 2010-2019 by frePPLe bvba

This library is free software; you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as published
by the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
General Public License for more details.

You should have received a copy of the GNU Affero General Public
License along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

"use strict";var operationplandetailapp=angular.module("operationplandetailapp",["ngCookies","gettext","ngWebSocket","frepple.input","frepple.common"],["$locationProvider",function(t){t.html5Mode({enabled:!0,requireBase:!1})}]);function operationplanCtrl(o,i){o.test="angular controller",o.operationplan=new i,o.aggregatedopplan=null,o.displayongrid=displayongrid,"function"==typeof o.displayongrid&&o.$watchGroup(["operationplan.id","operationplan.start","operationplan.end","operationplan.quantity","operationplan.status"],function(t,a){a[0]===t[0]&&-1!==t[0]&&void 0!==a[0]&&(void 0!==a[1]&&void 0!==t[1]&&a[1]!==t[1]&&o.displayongrid(o.operationplan.id,"startdate",o.operationplan.start),void 0!==a[2]&&void 0!==t[2]&&a[2]!==t[2]&&o.displayongrid(o.operationplan.id,"enddate",o.operationplan.end),void 0!==a[3]&&void 0!==t[3]&&a[3]!==t[3]&&o.displayongrid(o.operationplan.id,"quantity",o.operationplan.quantity),void 0!==a[4]&&void 0!==t[4]&&a[4]!==t[4]&&(actions.hasOwnProperty(o.operationplan.status)?o.displayongrid(o.operationplan.id,"status",o.operationplan.status):actions[Object.keys(actions)[0]]())),a[0]=t[0]}),o.processAggregatedInfo=function(t,a){var e=[],n={colmodel:{}},r=0;angular.forEach(a,function(t,a){t.hasOwnProperty("summaryType")&&(e.push([a,t.name,t.summaryType,t.formatter]),n[t.name]=null,n.colmodel[t.name]={type:t.summaryType,label:t.label})}),angular.forEach(t,function(a){angular.forEach(e,function(t){"sum"===t[2]?isNaN(parseFloat(a[t[1]]))||(null===n[t[1]]?n[t[1]]=parseFloat(a[t[1]]):n[t[1]]+=parseFloat(a[t[1]])):"max"===t[2]?-1!==["color","number","currency"].indexOf(t[3])&&""!==a[t[1]]?parseFloat(a[t[1]])&&(null===n[t[1]]?n[t[1]]=parseFloat(a[t[1]]):n[t[1]]=Math.max(n[t[1]],parseFloat(a[t[1]]))):"duration"===t[3]?"Invalid Date"!==(r=new moment.duration(a[t[1]]).asSeconds())._d&&(null===n[t[1]]?n[t[1]]=r:n[t[1]]=Math.max(n[t[1]],r)):"date"===t[3]&&"Invalid Date"!==(r=new moment(a[t[1]]))._d&&(null===n[t[1]]?n[t[1]]=r:n[t[1]]=moment.max(n[t[1]],r)):"min"===t[2]&&(-1!==["color","number"].indexOf(t[3])&&""!==a[t[1]]?(r=parseFloat(a[t[1]]),isNaN(r)||(null===n[t[1]]?n[t[1]]=r:n[t[1]]=Math.min(n[t[1]],r))):"duration"===t[3]?"Invalid Date"!==(r=new moment.duration(a[t[1]]).asSeconds())._d&&(null===n[t[1]]?n[t[1]]=r:n[t[1]]=Math.min(n[t[1]],r)):"date"===t[3]&&"Invalid Date"!==(r=new moment(a[t[1]]))._d&&(null===n[t[1]]?n[t[1]]=r:n[t[1]]=moment.min(n[t[1]],r)))})}),o.operationplan=new i,n.start=n.startdate,n.end=n.enddate,n.id=-1,n.type=t[0].type,o.$apply(function(){o.operationplan.extend(n)})},o.displayInfo=function(a){var t=void 0;void 0!==a&&(t=a.hasOwnProperty("operationplan__reference")?a.operationplan__reference:a.reference),o.operationplan=new i,o.operationplan.id=t,void 0===o.operationplan.id?o.$apply(function(){o.operationplan=new i}):o.operationplan.get(function(t){if(void 0===a)return t;void 0!==a.operationplan__startdate&&""!==a.operationplan__startdate?t.start=a.operationplan__startdate:void 0!==a.startdate&&""!==a.startdate&&(t.start=a.startdate),void 0!==a.operationplan__enddate&&""!==a.operationplan__enddate?t.end=a.operationplan__enddate:void 0!==a.enddate&&""!==a.enddate&&(t.end=a.enddate),void 0!==a.operationplan__quantity&&""!==a.operationplan__quantity?t.quantity=parseFloat(a.operationplan__quantity):void 0!==a.quantity&&""!==a.quantity&&(t.quantity=parseFloat(a.quantity)),void 0!==a.operationplan__status&&""!==a.operationplan__status?t.status=a.operationplan__status:void 0!==a.status&&""!==a.status&&(t.status=a.status)})},o.refreshstatus=function(t){"no_action"!==t&&o.$apply(function(){o.operationplan.status=t})},o.displayonpanel=function(t,a,e){angular.element(document).find("#"+o.operationplan.id).removeClass("edited").addClass("edited"),void 0!==o.operationplan.id&&t===o.operationplan.id.toString()&&("startdate"!==a&&"operationplan__startdate"!==a||o.$apply(function(){o.operationplan.start=e}),"enddate"!==a&&"operationplan__enddate"!==a||o.$apply(function(){o.operationplan.end=e}),"quantity"===a&&o.$apply(function(){o.operationplan.quantity=parseFloat(e)}),"status"===a&&o.refreshstatus(e))}}function showproblemspanelDrv(t,o){return{restrict:"EA",scope:{operationplan:"=data"},link:function(n,t,a){var r='<div class="panel-heading"><h4 class="panel-title" style="text-transform: capitalize">'+o.getString("problems")+'</h4></div><table class="table table-condensed table-hover"><thead><tr><td><b style="text-transform: capitalize;">'+o.getString("name")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("start")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("end")+"</b></td></tr></thead><tbody></tbody></table>";n.$watchGroup(["operationplan.id","operationplan.problems.length"],function(t,a){angular.element(document).find("#attributes-operationproblems").empty().append(r);var e='<tr><td colspan="3">'+o.getString("no problems")+"</td></tr>";void 0!==n.operationplan&&n.operationplan.hasOwnProperty("problems")&&(e="",angular.forEach(n.operationplan.problems,function(t){e+="<tr><td>"+t.description+"</td><td>"+t.start+"</td><td>"+t.end+"</td></tr>"})),angular.element(document).find("#attributes-operationproblems tbody").append(e)})}}}function showresourcespanelDrv(t,n){return{restrict:"EA",scope:{operationplan:"=data"},link:function(p,t,a){var e='<div class="panel-heading"><h4 class="panel-title" style="text-transform: capitalize">'+n.getString("resource")+'</h4></div><table class="table table-condensed table-hover"><thead><tr><td><b style="text-transform: capitalize;">'+n.getString("name")+'</b></td><td><b style="text-transform: capitalize;">'+n.getString("quantity")+"</b></td><tbody></tbody></table>";p.$watchGroup(["operationplan.id","operationplan.loadplans.length"],function d(){angular.element(document).find("#attributes-operationresources").empty().append(e);var a='<tr><td colspan="2">'+n.getString("no resources")+"</td></tr>";void 0!==p.operationplan&&p.operationplan.hasOwnProperty("loadplans")&&(a="",angular.forEach(p.operationplan.loadplans,function(t){t.hasOwnProperty("alternates")?(a+='<tr><td style="white-space: nowrap;"><div class="dropdown dropdown-submit-input"><button class="btn btn-default" data-toggle="dropdown" type="button" style="text-transform: capitalize; min-width: 150px">'+t.resource.name+'</button><ul class="dropdown-menu"><li><a role="menuitem" class="alternateresource" style="text-transform: capitalize">'+t.resource.name+"</a></li>",angular.forEach(t.alternates,function(t){a+='<li><a role="menuitem" class="alternateresource" style="text-transform: capitalize">'+t.name+"</a></li>"}),a+="</ul></td><td>"+grid.formatNumber(t.quantity)+"</td></tr>"):a+="<tr><td>"+t.resource.name+"</td><td>"+t.quantity+"</td></tr>"})),angular.element(document).find("#attributes-operationresources tbody").append(a),angular.element(document).find("#attributes-operationresources a.alternateresource").bind("click",function(){var i=$(this).html(),l=$(this).parent().parent().prev().html();i!=l&&angular.forEach(p.operationplan.loadplans,function(t){if(t.resource.name==l){t.resource.name=i,angular.forEach(t.alternates,function(t){t.name===i&&(t.name=l)}),d();var a=angular.element(document).find("#grid"),e=a.jqGrid("getGridParam","selarrrow"),n=a.jqGrid("getGridParam","colModel").find(function(t){return"resource"==t.name}),r=a.jqGrid("getCell",e,"resource");if("detail"==n.formatter&&r==l)a.jqGrid("setCell",e,"resource",i,"dirty-cell"),a.jqGrid("setRowData",e,!1,"edited"),angular.element(document).find("#save").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),angular.element(document).find("#undo").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1);else if("listdetail"==n.formatter){var o=[];angular.forEach(p.operationplan.loadplans,function(t){o.push([t.resource.name,t.quantity])}),a.jqGrid("setCell",e,"resource",o,"dirty-cell"),a.jqGrid("setRowData",e,!1,"edited"),angular.element(document).find("#save").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1),angular.element(document).find("#undo").removeClass("btn-primary btn-danger").addClass("btn-danger").prop("disabled",!1)}return!1}})})})}}}function showbufferspanelDrv(t,o){return{restrict:"EA",scope:{operationplan:"=data"},link:function(n,t,a,e){var r='<div class="panel-heading"><h4 class="panel-title" style="text-transform: capitalize">'+o.getString("material")+'</h4></div><table class="table table-condensed table-hover"><thead style="display: none;"><tr><td><b style="text-transform: capitalize;">'+o.getString("name")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("quantity")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("expected onhand")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("date")+"</b></td></tr></thead><tbody></tbody></table>";n.$watchGroup(["operationplan.id","operationplan.flowplans.length"],function(t,a){angular.element(document).find("#attributes-operationflowplans").empty().append(r);var e='<tr><td colspan="3">'+o.getString("no movements")+"<td></tr>";void 0!==n.operationplan&&n.operationplan.hasOwnProperty("flowplans")&&(e="",angular.forEach(n.operationplan.flowplans,function(t){e+="<tr><td>"+t.buffer.name+"</td><td>"+grid.formatNumber(t.quantity)+"</td><td>"+grid.formatNumber(t.onhand)+"</td><td>"+t.date+"</td></tr>"}),angular.element(document).find("#attributes-operationflowplans thead").css("display","table-header-group")),angular.element(document).find("#attributes-operationflowplans tbody").append(e)})}}}function showoperationpeggingpanelDrv(t,o){return{restrict:"EA",scope:{operationplan:"=data"},link:function(n,t,a,e){var r='<div class="panel-heading"><h4 class="panel-title" style="text-transform: capitalize">'+o.getString("demand")+'</h4></div><table class="table table-condensed table-hover"><thead><tr><td><b style="text-transform: capitalize;">'+o.getString("name")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("item")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("due")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("quantity")+"</b></td><tbody></tbody></table>";n.$watchGroup(["operationplan.id","operationplan.pegging_demand.length"],function(t,a){angular.element(document).find("#attributes-operationdemandpegging").empty().append(r);var e='<tr><td colspan="2">'+o.getString("no demands")+"</td></tr>";void 0!==n.operationplan&&n.operationplan.hasOwnProperty("pegging_demand")&&(e="",angular.forEach(n.operationplan.pegging_demand,function(t){e+="<tr><td>"+t.demand.name+"</td><td>"+t.demand.item.name+"</td><td>"+t.demand.due+"</td><td>"+grid.formatNumber(t.quantity)+"</td></tr>"})),angular.element(document).find("#attributes-operationdemandpegging tbody").append(e)})}}}function showoperationplanDrv(t,a){return{restrict:"EA",scope:{operationplan:"=data"},templateUrl:"/static/operationplandetail/operationplanpanel.html",link:function(e,n,t){e.actions=actions,e.opptype={MO:a.getString("Manufacturing Order"),PO:a.getString("Purchase Order"),DO:a.getString("Distribution Order"),STCK:a.getString("Stock"),DLVR:a.getString("Delivery")},e.$watchGroup(["operationplan.id","operationplan.start","operationplan.end","operationplan.quantity","operationplan.criticality","operationplan.delay","operationplan.status"],function(t,a){-1==e.operationplan.id||"STCK"===e.operationplan.type?(angular.element(n).find("input").attr("disabled","disabled"),angular.element(n).find("#statusrow .btn").removeClass("active").attr("disabled","disabled")):void 0!==e.operationplan.id?(angular.element(n).find("input[disabled]").attr("disabled",!1),"undefined"!=typeof actions&&actions.hasOwnProperty("proposed")&&angular.element(n).find("button[disabled]").attr("disabled",!1),angular.element(n).find("#statusrow .btn").removeClass("active"),e.operationplan.hasOwnProperty("start")&&angular.element(n).find("#setStart").val(moment(e.operationplan.start).format("YYYY-MM-DD HH:mm:ss")),e.operationplan.hasOwnProperty("end")&&angular.element(n).find("#setEnd").val(moment(e.operationplan.end).format("YYYY-MM-DD HH:mm:ss")),e.operationplan.hasOwnProperty("status")&&(angular.element(n).find("#statusrow .btn").removeClass("active"),angular.element(n).find("#"+e.operationplan.status+"Btn").addClass("active"))):(angular.element(n).find("input").attr("disabled","disabled"),angular.element(n).find("#statusrow .btn").removeClass("active").attr("disabled","disabled"),angular.element(n).find("#setStart").val(""),angular.element(n).find("#setEnd").val("")),angular.element(n).find("#statusrow").css("display",e.operationplan.status&&"STCK"!==e.operationplan.type?"table-row":"none")}),angular.element(n).find(".vDateField").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!1,calendarWeeks:!0,minDate:"2000-01-01",inline:!1,sideBySide:!0,icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-bullseye",clear:"fa fa-trash",close:"fa fa-remove"},locale:language,widgetPositioning:{horizontal:"left",vertical:"bottom"}}).on("dp.change",function(t){t.oldDate&&t.date!=t.oldDate&&("setStart"===t.target.id&&e.$apply(function(){e.operationplan.start=new moment(t.date).format("YYYY-MM-DDTHH:mm:ss")}),"setEnd"===t.target.id&&e.$apply(function(){e.operationplan.end=new moment(t.date).format("YYYY-MM-DDTHH:mm:ss")}))}).on("$destroy",function(){void 0!==$(this).data("DateTimePicker")&&$(this).data("DateTimePicker").destroy()})}}}function showsupplyinformationDrv(t,o){return{restrict:"EA",scope:{operationplan:"=data"},link:function(n,t,a){var r='<div class="panel-heading"><h4 class="panel-title" style="text-transform: capitalize">'+o.getString("supply information")+'</h4></div><div class="table-responsive"><table class="table table-hover table-condensed"><thead><tr><td><b style="text-transform: capitalize;">'+o.getString("priority")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("types")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("origin")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("lead time")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("cost")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("size minimum")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("size multiple")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("effective start")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("effective end")+"</b></td></tr></thead><tbody></tbody></table></div>";n.$watchGroup(["operationplan.id","operationplan.attributes.supply.length"],function(t,a){angular.element(document).find("#attributes-supplyinformation").empty().append(r);var e='<tr><td colspan="9">'+o.getString("no supply information")+"</td></tr>";void 0!==n.operationplan&&n.operationplan.attributes.hasOwnProperty("supply")&&(e="",angular.forEach(n.operationplan.attributes.supply,function(t){for(var a in e+="<tr>",t)e+="<td>",e+=t[a],e+="</td>";e+="</tr>"})),angular.element(document).find("#attributes-supplyinformation tbody").append(e)})}}}function shownetworkstatusDrv(t,o){return{restrict:"EA",scope:{operationplan:"=data"},link:function(n,t,a){var r='<div class="panel-heading"><h4 class="panel-title" style="text-transform: capitalize">'+o.getString("network status")+'</h4></div><table class="table table-condensed table-hover"><thead><tr><td><b style="text-transform: capitalize;">'+o.getString("item")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("location")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("onhand")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("purchase orders")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("distribution orders")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("manufacturing orders")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("overdue sales orders")+'</b></td><td><b style="text-transform: capitalize;">'+o.getString("sales orders")+"</b></td></tr></thead><tbody></tbody></table>";n.$watchGroup(["operationplan.id","operationplan.network.length"],function(t,a){angular.element(document).find("#attributes-networkstatus").empty().append(r);var e='<tr><td colspan="8">'+o.getString("no network information")+"</td></tr>";void 0!==n.operationplan&&n.operationplan.hasOwnProperty("network")&&(e="",angular.forEach(n.operationplan.network,function(t){e+="<tr><td>"+t[0],!0===t[1]&&(e+="<small>"+o.getString("superseded")+"</small>"),e+="</td><td>"+grid.formatNumber(t[2])+"</td><td>"+grid.formatNumber(t[3])+"</td><td>"+grid.formatNumber(t[4])+"</td><td>"+grid.formatNumber(t[5])+"</td><td>"+grid.formatNumber(t[6])+"</td><td>"+grid.formatNumber(t[7])+"</td><td>"+grid.formatNumber(t[8])+"</td></tr>"})),angular.element(document).find("#attributes-networkstatus tbody").append(e)})}}}operationplandetailapp.config(["$httpProvider",function(t){t.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",t.defaults.xsrfCookieName="csrftoken",t.defaults.xsrfHeaderName="X-CSRFToken"}]),operationplandetailapp.run(["gettextCatalog",function(t){t.setCurrentLanguage(language)}]),operationplandetailapp.filter("formatdate",function(){return function(t){if(void 0!==t)return moment(Date.parse(t)).format("YYYY-MM-DD HH:mm:ss")}}),angular.module("operationplandetailapp").controller("operationplandetailCtrl",operationplanCtrl),operationplanCtrl.$inject=["$scope","OperationPlan"],angular.module("operationplandetailapp").directive("showproblemspanelDrv",showproblemspanelDrv),showproblemspanelDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showresourcespanelDrv",showresourcespanelDrv),showresourcespanelDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showbufferspanelDrv",showbufferspanelDrv),showbufferspanelDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showoperationpeggingpanelDrv",showoperationpeggingpanelDrv),showoperationpeggingpanelDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showoperationplanDrv",showoperationplanDrv),showoperationplanDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showsupplyinformationDrv",showsupplyinformationDrv),showsupplyinformationDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("shownetworkstatusDrv",shownetworkstatusDrv),shownetworkstatusDrv.$inject=["$window","gettextCatalog"];
//# sourceMappingURL=frepple-operationplandetail.min.js.map