/* frePPLe 4.0.0
Copyright (C) 2010-2019 by frePPLe bvba

This library is free software; you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as published
by the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
General Public License for more details.

You should have received a copy of the GNU Affero General Public
License along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

function isDragnDropUploadCapable(){var t=document.createElement("div");return("draggable"in t||"ondragstart"in t&&"ondrop"in t)&&"FormData"in window&&"FileReader"in window}function breadcrumbs_reflow(){var t=$("#breadcrumbs"),e=Math.ceil($("#cockpitcrumb").height())+16;t.children("li:hidden").show();var a=!0;t.children("li").each(function(){t.height()>e&&!a&&$(this).hide(),a=!1})}function admin_escape(t){return t.replace(/_/g,"_5F").replace(/&amp;/g,"_26").replace(/&lt;/g,"_3C").replace(/&gt;/g,"_3E").replace(/&#39;/g,"'").replace(/&quot;/g,"_22").replace(/:/g,"_3A").replace(/\//g,"_2F").replace(/#/g,"_23").replace(/\?/g,"_3F").replace(/;/g,"_3B").replace(/@/g,"_40").replace(/&/g,"_26").replace(/=/g,"_3D").replace(/\+/g,"_2B").replace(/\$/g,"_24").replace(/,/g,"_2C").replace(/"/g,"_22").replace(/</g,"_3C").replace(/>/g,"_3E").replace(/%/g,"_25").replace(/\\/g,"_5C")}function admin_unescape(t){return t.replace(/_5F/g,"_").replace(/_22/g,'"').replace(/_3A/g,":").replace(/_2F/g,"/").replace(/_23/g,"#").replace(/_3F/g,"?").replace(/_3B/g,";").replace(/_40/g,"@").replace(/_26/g,"&").replace(/_3D/g,"=").replace(/_2B/g,"+").replace(/_24/g,"$").replace(/_2C/g,",").replace(/_3C/g,"<").replace(/_3E/g,">").replace(/_25/g,"%").replace(/_5C/g,"\\")}window.__admin_media_prefix__="/static/admin/",$.fn.resizable=function(t){var n={handleSelector:null,resizeWidth:!0,resizeHeight:!0,onDragStart:null,onDragEnd:null,onDrag:null,touchActionNone:!0};return"object"==typeof t&&(n=$.extend(n,t)),this.each(function(){var i,e,s=$(this);if(!$(this).hasClass("ui-jqgrid")){var t=n.handleSelector?$(n.handleSelector):s;n.touchActionNone&&t.css("touch-action","none"),s.addClass("resizable"),t.bind("mousedown.rsz touchstart.rsz",function(t){if((i=l(t)).width=parseInt(s.width(),10),i.height=parseInt(s.height(),10),e=s.css("transition"),s.css("transition","none"),n.onDragStart&&!1===n.onDragStart(t,s,n))return;n.dragFunc=o,$(document).bind("mousemove.rsz",n.dragFunc),$(document).bind("mouseup.rsz",r),(window.Touch||navigator.maxTouchPoints)&&($(document).bind("touchmove.rsz",n.dragFunc),$(document).bind("touchend.rsz",r));$(document).bind("selectstart.rsz",a)})}function a(t){t.stopPropagation(),t.preventDefault()}function o(t){var e=l(t);if(n.resizeWidth){var a=i.width+e.x-i.x;s.width(a)}if(n.resizeHeight){var o=i.height+e.y-i.y;s.height(o)}n.onDrag&&n.onDrag(t,s,n)}function r(t){return t.stopPropagation(),t.preventDefault(),$(document).unbind("mousemove.rsz",n.dragFunc),$(document).unbind("mouseup.rsz",r),(window.Touch||navigator.maxTouchPoints)&&($(document).unbind("touchmove.rsz",n.dragFunc),$(document).unbind("touchend.rsz",r)),$(document).unbind("selectstart.rsz",a),s.css("transition",e),n.onDragEnd&&n.onDragEnd(t,s,n),!1}function l(t){var e={x:0,y:0,width:0,height:0};if("number"==typeof t.clientX)e.x=t.clientX,e.y=t.clientY;else{if(!t.originalEvent.touches)return null;e.x=t.originalEvent.touches[0].clientX,e.y=t.originalEvent.touches[0].clientY}return e}})};var upload={warnUnsavedChanges:function(){return $(window).off("beforeunload",upload.warnUnsavedChanges),gettext("There are unsaved changes on this page.")},undo:function(){$("#undo").hasClass("btn-primary")||($("#grid").trigger("reloadGrid"),$("#grid").closest(".ui-jqgrid-bdiv").scrollTop(0),$("#save, #undo").addClass("btn-primary").removeClass("btn-danger").prop("disabled",!0),$("#actions1").prop("disabled",!0),$("#filter").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges))},select:function(){$("#filter").prop("disabled",!0),$.jgrid.hideModal("#searchmodfbox_grid"),$("#save, #undo").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges),$(window).on("beforeunload",upload.warnUnsavedChanges)},selectedRows:[],restoreSelection:function(){for(var t in grid.markSelectedRow(upload.selectedRows.length),upload.selectedRows)$("#grid").jqGrid("setSelection",upload.selectedRows[t],!1);upload.selectedRows=[]},save:function(){if(!$("#save").hasClass("btn-primary")){if($("#grid").saveCell(editrow,editcol),"function"==typeof getDirtyData)var t=getDirtyData();else t=$("#grid").getChangedCells("dirty");upload.selectedRows=$("#grid").jqGrid("getGridParam","selarrrow").slice(),null!=t&&0<t.length&&$.ajax({url:location.pathname,data:JSON.stringify(t),type:"POST",contentType:"application/json",success:function(){upload.undo()},error:function(t,e,a){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-danger"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Error saving data")+'</h4></div><div class="modal-body"><p>'+t.responseText+'</p></div><div class="modal-footer"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Close")+'"></div></div></div>').modal("show")}})}},validateSort:function(t){"grid_cb"!=$(this).attr("id")&&($("body").hasClass("popup")||($("#save").hasClass("btn-primary")?jQuery("#grid").jqGrid("resetSelection"):($("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header alert-warning" style="border-top-left-radius: inherit; border-top-right-radius: inherit"><h4 class="modal-title">'+gettext("Save or cancel your changes first")+'</h4></div><div class="modal-body">'+gettext("There are unsaved changes on this page.")+'</div><div class="modal-footer"><input type="submit" id="savebutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Save")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#savebutton").on("click",function(){upload.save(),$("#popup").modal("hide")}),$("#cancelbutton").on("click",function(){upload.undo(),$("#popup").modal("hide")}),t.stopPropagation())))}};function opendetail(t){var e=$(t.target).parent(),a=e.attr("href"),o=e.attr("objectid");void 0!==o&&0!=o||(o=e.parent().text().trim()),t.preventDefault(),t.stopImmediatePropagation(),window.location.href=url_prefix+a.replace("key",admin_escape(o))}function formatDuration(t,e,a){var o,i,s=0,r=0,l=1,n=[],d=[];if(void 0===t||""===t||null===t)return"";if("number"==typeof t)r=t,l=Math.sign(r);else switch(l=-1<t.indexOf("-")?-1:1,s=1==(n=t.replace(/ +/g," ").split(" ")).length?(d=t.split(":"),0):(d=n[1].split(":"),""!=n[0]?parseFloat(n[0]):0),d.length){case 0:r=86400*Math.abs(s);break;case 1:r=86400*Math.abs(s)+(""!=d[0]?Math.abs(parseFloat(d[0])):0);break;case 2:r=86400*Math.abs(s)+60*(""!=d[0]?Math.abs(parseFloat(d[0])):0)+(""!=d[1]?parseFloat(d[1]):0);break;default:r=86400*Math.abs(s)+3600*(""!=d[0]?Math.abs(parseFloat(d[0])):0)+60*(""!=d[1]?parseFloat(d[1]):0)+(""!=d[2]?parseFloat(d[2]):0)}return r=(r=Math.abs(r))-86400*(s=Math.floor(r/86400))-3600*(o=Math.floor((r-86400*s)/3600))-60*(i=Math.floor((r-86400*s-3600*o)/60)),998<a.criticality?"N/A":0<s?(l*s).toString()+" "+(o<10?"0":"")+o+(i<10?":0":":")+i+(r<10?":0":":")+Number(r.toFixed(r===Math.floor(r)?0:6)):(l<0?"-":"")+(o<10?"0":"")+o+(i<10?":0":":")+i+(r<10?":0":":")+Number(r.toFixed(r===Math.floor(r)?0:6))}jQuery.extend($.fn.fmatter,{percentage:function(t,e,a){return void 0===t||""===t||null===t?"":t+"%"},duration:formatDuration,admin:function(t,e,a){return void 0===t||""===t||null===t?"":e.colModel.popup||"0"===a.showdrilldown?t:t+"<a href='"+url_prefix+"/data/"+e.colModel.role+"/"+admin_escape(t)+"/change/' onclick='event.stopPropagation()'><span class='leftpadding fa fa-caret-right'></span></a>"},detail:function(t,e,a){return void 0===t||""===t||null===t?"":e.colModel.popup||"0"===a.showdrilldown?t:(!a.hasOwnProperty("type")||"PO"!==a.type&&"DO"!==a.type&&"DLVR"!==a.type&&"STCK"!==a.type)&&(!a.hasOwnProperty("operationplan__type")||"PO"!==a.operationplan__type&&"DO"!==a.operationplan__type&&"DLVR"!==a.operationplan__type&&"STCK"!==a.operationplan__type)?t+"<a href='"+url_prefix+"/detail/"+e.colModel.role+"/"+admin_escape(t)+"/' onclick='event.stopPropagation()'><span class='leftpadding fa fa-caret-right'></span></a>":t},demanddetail:function(t,e,a){if(void 0===t||""===t)return"";if(e.colModel.popup)return t;for(var o="",i=t.length,s=0;s<i;s++)""!=o&&(o+=", "),o+=t[s][0]+" : "+t[s][1]+"<a href='"+url_prefix+"/detail/input/demand/"+admin_escape(t[s][1])+"/' onclick='event.stopPropagation()'><span class='leftpadding fa fa-caret-right' role='input/demand'></span></a>";return o},listdetail:function(t,e,a){if(void 0===t||""===t)return"";if(e.colModel.popup)return t;for(var o="",i=t.length,s=0;s<i;s++)""!=o&&(o+=", "),o+='<span><span class="listdetailkey">'+t[s][0]+"</span><a href='"+url_prefix+"/detail/"+e.colModel.role+"/"+admin_escape(t[s][0])+"/' onclick='event.stopPropagation()'><span class='leftpadding fa fa-caret-right' role='"+e.colModel.role+"'></span></a></span>&nbsp;<span>"+t[s][1]+"</span>";return o},graph:function(t,e,a){return'<div class="graph" style="height:80px"></div>'},longstring:function(t,e,a){return"string"!=typeof t?"":'<span data-toggle="tooltip" data-placement="left" data-original-title="'+t.replace(/"/g,"'")+'">'+t+"</span>"},color:function(t,e,a){if(void 0===t||""===t)return"";var o=parseInt(t);if(a.inventory_item||a.leadtime){if(!isNaN(o))return 100<=o&&o<999999?'<div class="invStatus" style="text-align: center; background-color: #008000; color: #151515;">'+Math.round(t)+"%</div>":0===o?'<div class="invStatus" style="text-align: center; background-color: #f00; color: #151515;">'+Math.round(t)+"%</div>":999999===o?"":'<div class="invStatus" style="text-align: center; background-color: rgb(255,'+(o=Math.round(o/100*255))+',0); color: #151515;">'+Math.round(t)+"%</div>"}else{var i=Math.round(parseInt(a.delay)/8640)/10;if(999===parseInt(a.criticality)||999===parseInt(a.operationplan__criticality))return'<div class="invStatus" style="text-align: center; background-color: #f00; color: #151515;"></div>';if(i<0)return'<div class="invStatus" style="text-align: center; background-color: #008000; color: #151515;">'+-i+" "+gettext("days early")+"</div>";if(0==i)return'<div class="invStatus" style="text-align: center; background-color: #008000; color: #151515;">'+gettext("on time")+"</div>";if(0<i)return 100<o||o<0?'<div class="invStatus" style="text-align: center; background-color: #f00; color: #151515;">'+i+" "+gettext("days late")+"</div>":'<div class="invStatus" style="text-align: center; background-color: rgb(255,'+Math.round(o/100*255)+',0); color: #151515;">'+i+" "+gettext("days late")+"</div>"}return""},number:function(t,e){return grid.formatNumber(t)}}),jQuery.extend($.fn.fmatter.percentage,{unformat:function(t,e,a){return t}}),jQuery.extend($.fn.fmatter.listdetail,{unformat:function(t,e,a){var o=[];return $(".listdetailkey",$(a)).each(function(t,e){o.push([$(e).text(),$(e).parent().next("span").text()])}),o}});var grid={selected:void 0,formatNumber:function(t){if(void 0===t)return"";var e=$.fmatter.isNumber;if(e(t)||(t*=1),e(t)){var a,o=t<0;a=1e6<t?String(parseFloat(t.toFixed(1))):String(parseFloat(t.toPrecision(8)));var i=jQuery("#grid").jqGrid("getGridRes","formatter.number.decimalSeparator")||".";"."!==i&&(a=a.replace(".",i));var s=jQuery("#grid").jqGrid("getGridRes","formatter.number.thousandsSeparator")||",";if(s){var r=a.lastIndexOf(i);r=-1<r?r:a.length;var l,n=a.substring(r),d=-1;for(l=r;0<l;l--)++d%3==0&&l!==r&&(!o||1<l)&&(n=s+n),n=a.charAt(l-1)+n;a=n}return a}return t},summary_last:function(t,e,a){return a[e]},summary_first:function(t,e,a){return t||a[e]},setSelectedRow:function(t){null!=grid.selected&&$(this).jqGrid("setCell",grid.selected,"select",null),grid.selected=t,$(this).jqGrid("setCell",t,"select",'<input type="checkbox" onClick="opener.dismissRelatedLookupPopup(window, grid.selected);" class="btn btn-primary" style="width: 18px; height: 18px;" data-toggle="tooltip" title="'+gettext("Click to select record")+'"></input>')},runAction:function(t){"no_action"!=$("#actions").val()&&actions[$("#actions").val()]()},setStatus:function(t){var e=jQuery("#grid").jqGrid("getGridParam","selarrrow");for(i in e)jQuery("#grid").jqGrid("setCell",e[i],"status",t,"dirty-cell"),jQuery("#grid").jqGrid("setRowData",e[i],!1,"edited");$("#actions1").html(gettext("Select action")+'&nbsp;&nbsp;<span class="caret"></span>'),$("#save").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1),$("#undo").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1)},pivotcolumns:function(t,e,a){var o="";for(i in cross_idx)""!=o&&(o+="<br>"),cross[cross_idx[i]].editable?o+='<span class="editablepivotcol">'+cross[cross_idx[i]].name+"</span>":o+=cross[cross_idx[i]].name;return o},showCustomize:function(r,t,e,a,o,i,s){var l=$(void 0!==t?t:"#grid").jqGrid("getGridParam","colModel"),n=0,d=0,c=!1,p=r&&void 0!==o&&o,u=p?"":'<div class="row"><div class="col-xs-6"><div class="panel panel-default"><div class="panel-heading">'+gettext("Selected options")+'</div><div class="panel-body"><ul class="list-group" id="Rows" style="height: 160px; overflow-y: scroll;">placeholder0</ul></div></div></div><div class="col-xs-6"><div class="panel panel-default"><div class="panel-heading">'+gettext("Available options")+'</div><div class="panel-body"><ul class="list-group" id="DroppointRows" style="height: 160px; overflow-y: scroll;">placeholder1</ul></div></div></div></div>',h="",m="",g="",f="",v="",b="";for(var y in l)"graph"==l[y].name?c=!0:"rn"==l[y].name||"cb"==l[y].name||null==l[y].counter||""==l[y].label||"alwayshidden"in l[y]?d++:(l[y].frozen&&(n=parseInt(y,10)+1-d),l[y].hidden?f+='<li id="'+y+'"  class="list-group-item" style="cursor: move;">'+l[y].label+"</li>":g+='<li id="'+y+'"  class="list-group-item" style="cursor: move;">'+l[y].label+"</li>");if(r){var x=void 0!==e?e:cross,w=void 0!==a?a:cross_idx;h='<div class="row"><div class="col-xs-6"><div class="panel panel-default"><div class="panel-heading">'+gettext("Selected Cross")+'</div><div class="panel-body"><ul class="list-group" id="Crosses" style="height: 160px; overflow-y: scroll;">placeholder0</ul></div></div></div><div class="col-xs-6"><div class="panel panel-default"><div class="panel-heading">'+gettext("Available Cross")+'</div><div class="panel-body"><ul class="list-group" id="DroppointCrosses" style="height: 160px; overflow-y: scroll;">placeholder1</ul></div></div></div></div>';for(var k in w)v+='<li class="list-group-item" id="'+(100+parseInt(w[k],10))+'" style="cursor: move;">'+x[w[k]].name+"</li>";for(var k in x)-1<w.indexOf(parseInt(k,10))||""==x[k].name||(b+='<li class="list-group-item" id="'+(100+parseInt(k,10))+'" style="cursor: move;">'+x[k].name+"</li>")}else m='<div class="row"><div class="col-xs-12">'+gettext("Frozen columns")+'&nbsp;&nbsp;<input type="number" id="frozen" style="text-align: center;" min="0" max="4" step="1" value="'+n+'"></div></div>';if(u=(u=u.replace("placeholder0",g)).replace("placeholder1",f),r&&(h=(h=h.replace("placeholder0",v)).replace("placeholder1",b)),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label='+gettext("Close")+'><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Customize")+'</h4></div><div class="modal-body">'+u+h+m+'</div><div class="modal-footer"><input type="submit" id="okCustbutton" role="button" class="btn btn-danger pull-left" value="'+gettext("OK")+'"><input type="submit" id="cancelCustbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="resetCustbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Reset")+'"></div></div></div>').modal("show"),!p){var C=document.getElementById("Rows"),_=document.getElementById("DroppointRows");Sortable.create(C,{group:{name:"Rows",put:["DroppointRows"]},animation:100}),Sortable.create(_,{group:{name:"DroppointRows",put:["Rows"]},animation:100})}if(r){var M=document.getElementById("Crosses"),D=document.getElementById("DroppointCrosses");Sortable.create(M,{group:{name:"Crosses",put:["DroppointCrosses"]},animation:100}),Sortable.create(D,{group:{name:"DroppointCrosses",put:["Crosses"]},animation:100})}$("#resetCustbutton").on("click",void 0!==s?s:function(){var t={};if(t[reportkey]=null,"undefined"!=typeof url_prefix)var e=url_prefix+"/settings/";else e="/settings/";$.ajax({url:e,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),success:function(){window.location.href=window.location.href},error:function(t,e,a){$("#popup").html('<div class="modal-dialog" style="width: auto"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Error retrieving data")+'</h4></div><div class="modal-body"><p>'+t.responseText+"  "+e+a+'</p></div><div class="modal-footer"></div></div></div>').modal("show")}})}),$("#okCustbutton").on("click",void 0!==i?i:function(){var t=$("#grid")[0].p.colModel,e=[],a=[];"cb"==t[0].name&&e.push(0),cross_idx=[],c||$("#grid").jqGrid("destroyFrozenColumns"),$("#Rows li").each(function(){val=parseInt(this.id,10),val<100&&($("#grid").jqGrid("showCol",t[val].name),e.push(val))}),$("#DroppointRows li").each(function(){val=parseInt(this.id,10),val<100&&(a.push(val),r&&$("#grid").jqGrid("setColProp",t[val].name,{frozen:!1}),$("#grid").jqGrid("hideCol",t[val].name))}),$("#Crosses li").each(function(){val=parseInt(this.id,10),100<=val&&cross_idx.push(val-100)});var o=0;if(r){for(var i in t)"counter"in t[i]?o=i+1:e.push(parseInt(i,10))}else o=parseInt($("#frozen").val());for(var i in a)e.push(a[i]);$("#grid").jqGrid("remapColumns",e,!0);var s=0;for(var i in t)"rn"!=t[i].name&&"cb"!=t[i].name&&null!=t[i].counter?$("#grid").jqGrid("setColProp",t[i].name,{frozen:i-s<o}):s++;c||$("#grid").jqGrid("setFrozenColumns"),$("#grid").trigger("reloadGrid"),grid.saveColumnConfiguration(),$("#popup").modal("hide")})},saveColumnConfiguration:function(t,e){var a=new Array,o=$("#grid").jqGrid("getGridParam","colModel"),i=0,s=!1,r=0,l=$("#grid").jqGrid("getGridParam","page");for(var n in"string"==typeof t?0<=t.indexOf("next")?++l:0<=t.indexOf("prev")?--l:0<=t.indexOf("last")?l=$("#grid").jqGrid("getGridParam","lastpage"):0<=t.indexOf("first")?l=1:0<=t.indexOf("user")&&(l=$("input.ui-pg-input").val()):void 0!==e&&"operationplans"==o[e].name&&gantt.redraw(),o)"rn"!=o[n].name&&"cb"!=o[n].name&&"counter"in o[n]&&!("alwayshidden"in o[n])?(a.push([o[n].name,o[n].hidden,o[n].width]),o[n].frozen&&(i=parseInt(n)+1-r)):"columns"==o[n].name||"graph"==o[n].name?s=!0:r++;var d={},c=$("#grid").getGridParam("postData").filters;void 0!==c&&c.rules!=[]?d[reportkey]={rows:a,page:l,filter:c}:d[reportkey]={rows:a,page:l};var p=$("#grid").getGridParam("sortname");if(""!==p&&(d[reportkey].sidx=p,d[reportkey].sord=$("#grid").getGridParam("sortorder")),s)for(var n in d[reportkey].crosses=[],cross_idx)d[reportkey].crosses.push(cross[cross_idx[n]].key);else d[reportkey].frozen=i;if("function"==typeof extraPreference){var u=extraPreference();for(var h in u)d[reportkey][h]=u[h]}if("undefined"!=typeof url_prefix)var m=url_prefix+"/settings/";else m="/settings/";$.ajax({url:m,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(){"function"==typeof t&&t()},error:function(t,e,a){$("#popup").html('<div class="modal-dialog" style="width: auto"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Error saving report settings")+'</h4></div><div class="modal-body"><p>'+t.responseText+"  "+e+a+'</p></div><div class="modal-footer"></div></div></div>').modal("show")}})},afterEditCell:function(t,e,a,o,i){var s=$(this).jqGrid("getGridParam","colModel")[i];iconslist={time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-bullseye",clear:"fa fa-trash",close:"fa fa-remove"},"date"==s.formatter?"Y-m-d"==s.formatoptions.srcformat?$("#"+o+"_"+e).on("focusin",function(){$(this).parent().css({position:"relative",overflow:"visible"}),$(this).datetimepicker({format:"YYYY-MM-DD",useCurrent:!1,calendarWeeks:!0,icons:iconslist,locale:document.documentElement.lang,widgetPositioning:{horizontal:"auto",vertical:o<11?"bottom":"auto"}})}):$("#"+o+"_"+e).on("focusin",function(){$(this).parent().css({position:"relative",overflow:"visible"}),$(this).datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!1,calendarWeeks:!0,icons:iconslist,locale:document.documentElement.lang,widgetPositioning:{horizontal:"auto",vertical:o<11?"bottom":"auto"}})}):$("#"+o+"_"+e).select()},showExport:function(t){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),t?$("#popup").html('<div class="modal-dialog" style="width: 350px;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize-first">'+gettext("Export CSV or Excel file")+'</h4></div><div class="modal-body"><label class="control-label">'+gettext("Export format")+'<div class="radio" name="csvformat" id="csvformat" value="spreadsheetlist">&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="spreadsheetlist" checked="">'+gettext("Spreadsheet list")+'</label><br>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="csvlist">'+gettext("CSV list")+'</label><br></div></label></div><div class="modal-footer"><input type="submit" id="exportbutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Export")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"):$("#popup").html('<div class="modal-dialog" style="width: 350px;"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">'+gettext("Export CSV or Excel file")+'</h4></div><div class="modal-body"><label class="control-label">'+gettext("Export format")+'<div class="radio" name="csvformat" id="csvformat" value="spreadsheettable">&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="spreadsheettable" checked="">'+gettext("Spreadsheet table")+'</label><br>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="spreadsheetlist">'+gettext("Spreadsheet list")+'</label><br>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="csvtable">'+gettext("CSV table")+'</label><br>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="csvlist">'+gettext("CSV list")+'</label><br></div></label></div><div class="modal-footer"><input type="submit" id="exportbutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Export")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#exportbutton").on("click",function(){var t=-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href;0<location.search.length?t+="&format="+$("#csvformat input:radio:checked").val():"?"==t.charAt(t.length-1)?t+="format="+$("#csvformat input:radio:checked").val():t+="?format="+$("#csvformat input:radio:checked").val();var e=$("#grid").jqGrid("getGridParam","postData");t+="&"+jQuery.param(e),window.open(t,"_blank"),$("#popup").modal("hide")})},showBucket:function(){$("#popup").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),iconslist={time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-bullseye",clear:"fa fa-trash",close:"fa fa-remove"},$("#horizonstart").datetimepicker({format:"YYYY-MM-DD",calendarWeeks:!0,icons:iconslist,locale:document.documentElement.lang}),$("#horizonend").datetimepicker({format:"YYYY-MM-DD",calendarWeeks:!0,icons:iconslist,locale:document.documentElement.lang}),$("#horizonstart").on("dp.change",function(t){$("#horizonend").data("DateTimePicker").minDate(t.date)}),$("#okbutton").on("click",function(){$("#horizonbuckets").val()+"|"+$("#horizonstart").val()+"|"+$("#horizonend").val()+"|"+($("#horizontype").is(":checked")?"True":"False")+"|"+$("#horizonlength").val()+"|"+$("#horizonunit").val()==$("#horizonoriginal").val()?$("#timebuckets").modal("hide"):($.ajax({type:"POST",url:"/horizon/",data:{horizonbuckets:$("#horizonbuckets").val()?$("#horizonbuckets").val():$("#horizonbucketsul li a").first().text(),horizonstart:$("#horizonstart").val(),horizonend:$("#horizonend").val(),horizontype:$("#horizontype").is(":checked")?"1":"0",horizonlength:$("#horizonlength").val(),horizonunit:$("#horizonunit").val()},dataType:"text/html",async:!1}),window.location.href=window.location.href)}),$("#timebuckets").modal("show")},showDelete:function(){if(!$("#delete_selected").hasClass("disabled")){var t=jQuery("#grid").jqGrid("getGridParam","selarrrow");1==t.length?location.href=location.pathname+admin_escape(t[0])+"/delete/":0<t.length&&($("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize-first">'+gettext("Delete data")+'</h4></div><div class="modal-body"><p>'+interpolate(gettext("You are about to delete %s objects AND ALL RELATED RECORDS!"),[t.length],!1)+'</p></div><div class="modal-footer"><input type="submit" id="delbutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Confirm")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#delbutton").on("click",function(){$.ajax({url:location.pathname,data:JSON.stringify([{delete:t}]),type:"POST",contentType:"application/json",success:function(){$("#delete_selected").prop("disabled",!0).removeClass("bold"),$("#copy_selected").prop("disabled",!0).removeClass("bold"),$(".cbox").prop("checked",!1),$("#cb_grid.cbox").prop("checked",!1),$("#grid").trigger("reloadGrid"),$("#popup").modal("hide")},error:function(t,e,a){$("#popup .modal-body p").html(t.responseText),$("#popup .modal-title").html(gettext("Error deleting data")),$("#popup .modal-header").addClass("bg-danger"),$("#delbutton").prop("disabled",!0).hide()}})}))}},showCopy:function(){if(!$("#copy_selected").hasClass("disabled")){var t=jQuery("#grid").jqGrid("getGridParam","selarrrow");0<t.length&&($("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize-first">'+gettext("Copy data")+'</h4></div><div class="modal-body"><p>'+interpolate(gettext("You are about to duplicate %s objects"),[t.length],!1)+'</p></div><div class="modal-footer"><input type="submit" id="copybutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Confirm")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#copybutton").on("click",function(){$.ajax({url:location.pathname,data:JSON.stringify([{copy:t}]),type:"POST",contentType:"application/json",success:function(){$("#delete_selected").prop("disabled",!0).removeClass("bold"),$("#copy_selected").prop("disabled",!0).removeClass("bold"),$(".cbox").prop("checked",!1),$("#cb_grid.cbox").prop("checked",!1),$("#grid").trigger("reloadGrid"),$("#popup").modal("hide")},error:function(t,e,a){$("#popup .modal-body p").html(t.responseText),$("#popup .modal-title").html(gettext("Error copying data")),$("#popup .modal-header").addClass("bg-danger"),$("#copybutton").prop("disabled",!0).hide()}})}))}},showPlanExportModal:function(){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid");var t="",e="";for(i=0;i<data.labels.length;i++)t+="<th>"+gettext(data.labels[i])+"</th>";for(i=0;i<data.values.length;i++){for(e+='<tr><td><input id="cb_modaltable-'+i+'" class="cbox" type="checkbox" aria-checked="false"></td>',j=0;j<data.values[i].length;j++)e+="<td>"+gettext(data.values[i][j])+"</td>";e+="</tr>"}$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize-first">'+gettext("Export Plan")+'</h4></div><div class="modal-body"><div class="table-responsive"><table class="table-condensed table-hover" id="forecastexporttable"><thead class="thead-default"><tr><th><input id="cb_modaltableall" class="cbox" type="checkbox" aria-checked="false"></th>'+t+"</tr></thead><tbody><tr>"+e+'</tr></tbody></table></div></div><div class="modal-footer"><input type="submit" id="exportbutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Export")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#exportbutton").on("click",function(){$("#popup").modal("hide")}),$("#cancelbutton").on("click",function(){$("#popup").modal("hide")}),$("#cb_modaltableall").on("click",function(){$("#cb_modaltableall").is(":checked")?($("#forecastexporttable input[type=checkbox]").each(function(){$(this).prop("checked",!0)}),$("#forecastexporttable tr").each(function(){$(this).addClass("selected")})):($("#forecastexporttable input[type=checkbox]").each(function(){$(this).prop("checked",!1)}),$("#forecastexporttable tr.selected").each(function(){$(this).removeClass("selected")}))})},showFilter:function(t,e,a){var o=void 0!==t?t:"grid",i=$("#"+o),s=$(void 0!==e?e:"#curfilter"),r=$(void 0!==a?a:"#filter");r.hasClass("disabled")||($(".modal").modal("hide"),i.jqGrid("searchGrid",{closeOnEscape:!0,multipleSearch:!0,multipleGroup:!0,overlay:0,sopt:["eq","ne","lt","le","gt","ge","bw","bn","in","ni","ew","en","cn","nc"],onSearch:function(){grid.saveColumnConfiguration(),grid.getFilterGroup(i,$("#fbox_"+o).jqFilter("filterData"),!0,s),s.is(":empty")?r.addClass("btn-danger").removeClass("btn-primary"):r.removeClass("btn-danger").addClass("btn-primary")},onReset:function(){return"undefined"!=typeof initialfilter?(i.jqGrid("getGridParam","postData").filters=JSON.stringify(initialfilter),grid.getFilterGroup(i,initialfilter,!0,s),r.addClass("btn-danger").removeClass("btn-primary")):(s.html(""),r.removeClass("btn-danger").addClass("btn-primary")),grid.saveColumnConfiguration(),!0}}))},countFilters:0,updateFilter:function(t,e,a){if(t instanceof Array)for(var o in t)grid.updateFilter(t[o],e,a);else if("object"==typeof t)for(var o in t)"filtercount"==o&&t[o]==e?t.data=a:t.hasOwnProperty(o)&&grid.updateFilter(t[o],e,a)},getFilterRule:function(e,a,o,i){var t,s,r,l=e.jqGrid("getGridParam","colModel");for(t=0;t<l.length;t++)if(l[t].name===a.field){s=l[t];break}if(null!=s){if("win"==a.op)r=gettext("within");else{for(var n in $.jgrid.locales)var d=$.jgrid.locales[n].search.odata;for(t=0;t<d.length;t++)if(d[t].oper==a.op){r=d[t].text;break}null==r&&(r=a.op)}o.append(s.label+"&nbsp;"+r+"&nbsp;");var c=$('<input size="10">');c.val(a.data),a.filtercount=grid.countFilters++,c.on("change",function(t){grid.updateFilter(i,a.filtercount,$(t.target).val()),e.setGridParam({postData:{filters:JSON.stringify(i)},search:!0}).trigger("reloadGrid"),grid.saveColumnConfiguration(),o.is(":empty")?$("#filter").removeClass("btn-danger").addClass("btn-primary"):$("#filter").addClass("btn-danger").removeClass("btn-primary")}),o.append(c),"win"==a.op&&o.append("&nbsp;"+gettext("days"))}},getFilterGroup:function(t,e,a,o,i){if(a?(o.html(""),i=e,grid.countFilters=0):o.append("("),void 0!==e.groups)for(var s=0;s<e.groups.length;s++)1<o.html().length&&("OR"===e.groupOp?o.append(" || "):o.append(" && ")),grid.getFilterGroup(t,e.groups[s],!1,o,i);if(void 0!==e.rules)for(s=0;s<e.rules.length;s++)1<o.html().length&&o.append("OR"===e.groupOp?" || ":" && "),grid.getFilterRule(t,e.rules[s],o,i);a?1<o.html().length&&o.prepend(gettext("Filtered where")+"&nbsp;"):o.append(")")},markSelectedRow:function(t){void 0===t&&(t=0),0<t?($("#copy_selected").prop("disabled",!1).addClass("bold"),$("#delete_selected").prop("disabled",!1).addClass("bold"),$("#actions1").prop("disabled",!1)):($("#copy_selected").prop("disabled",!0).removeClass("bold"),$("#delete_selected").prop("disabled",!0).removeClass("bold"),$("#actions1").prop("disabled",!0))},markAllRows:function(){$(this).is(":checked")?($("#copy_selected").prop("disabled",!1).addClass("bold"),$("#delete_selected").prop("disabled",!1).addClass("bold"),$("#actions1").prop("disabled",!1),$(".cbox").prop("checked",!0)):($("#copy_selected").prop("disabled",!0).removeClass("bold"),$("#delete_selected").prop("disabled",!0).removeClass("bold"),$("#actions1").prop("disabled",!0),$(".cbox").prop("checked",!1))},displayMode:function(t){var e=-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href;0<location.search.length?e=e.replace("&mode=table","").replace("&mode=graph","").replace("mode=table","").replace("mode=graph","")+"&mode="+t:"?"==e.charAt(e.length-1)?e+="mode="+t:e+="?mode="+t,window.location.href=e}},ERPconnection={IncrementalExport:function(a,t){var o=a.jqGrid("getGridParam","selarrrow");if(null!==o&&0!=o.length){var e=[];for(var i in o){var s=a.jqGrid("getRowData",o[i]);void 0===s.type&&(s.type=t),"proposed"==s.status&&e.push(s)}e!=[]&&($("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize-first">'+gettext("export")+'</h4></div><div class="modal-body"><p class="text-capitalize-first">'+gettext("export selected records")+'</p></div><div class="modal-footer"><input type="submit" id="button_export" role="button" class="btn btn-danger pull-left" value="'+gettext("Confirm")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#button_export").on("click",function(){$("#popup .modal-body p").html(gettext("connecting")+"..."),$.ajax({url:url_prefix+"/erp/upload/",data:JSON.stringify(e),type:"POST",contentType:"application/json",success:function(){var t=[];for(var e in $("#popup .modal-body p").html(gettext("Export successful")),$("#cancelbutton").val(gettext("Close")),$("#button_export").removeClass("btn-primary").prop("disabled",!0),o){"proposed"===a.jqGrid("getCell",o[e],"status")&&(a.jqGrid("setCell",o[e],"status","approved"),(t=a.jqGrid("getRowData",o[e])).status="approved")}a.jqGrid("setRowData",t),"function"==typeof checkrows&&checkrows(a,o)},error:function(t,e,a){fmts=ngettext("Error during export"),$("#popup .modal-title").html(gettext("Error during export")),$("#popup .modal-header").addClass("bg-danger"),$("#popup .modal-body p").html(gettext("Error during export")+":"+t.responseText),$("#button_export").text(gettext("retry"))}})}),$("#actions1").html($("#actionsul").children().first().text()+'  <span class="caret"></span>'))}},SODepExport:function(s,r){var l=s.jqGrid("getGridParam","selarrrow");if(null!==l&&0!=l.length){var t=[];for(var n in l){void 0===(a=s.jqGrid("getRowData",l[n])).type&&(a.type=r),t.push(a)}if(t!=[]){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog" style="max-height: 80%; width: 90%; visibility: hidden"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize-first">'+gettext("export")+'</h4></div><div class="modal-body"></div><div class="modal-footer"><input type="submit" id="button_export" role="button" class="btn btn-danger pull-left" disabled value="'+gettext("Confirm")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>');var e="?demand=";for(n=0;n<l.length;n++){var a;void 0===(a=s.jqGrid("getRowData",l[n])).type&&(a.type=r),"open"!=a.status&&"proposed"!=a.status||(e+=0==n?encodeURIComponent(l[n]):"&demand="+encodeURIComponent(l[n]))}$.ajax({url:url_prefix+"/demand/operationplans/"+e,type:"GET",contentType:"application/json",success:function(i){$("#popup .modal-body").html('<div class="table-responsive"><table class="table-condensed table-hover" id="forecastexporttable"><thead class="thead-default"></thead></table></div>'),labels=["id","type","item","value","quantity","location","origin","startdate","enddate","criticality"];if("SO"==r){var t=$("<tr/>");for(t.append($("<th/>").html('<input id="cb_modaltableall" class="cbox" type="checkbox" aria-checked="false">')),n=0;n<labels.length;n++)t.append($("<th/>").addClass("text-capitalize").text(gettext(labels[n])));var e=$("<tbody/>");for(n=0;n<i.length;n++){var a=$("<tr/>"),o=$("<td/>");for(o.append($("<input/>").attr({id:"cb_modaltable-"+n,class:"cbox",type:"checkbox","aria-checked":"false"})),a.append(o),j=0;j<labels.length;j++)a.append($("<td/>").text(i[n][labels[j]]));e.append(a)}}$("#popup table").append(e),$("#popup thead").append(t),$("#popup").modal({backdrop:"static",keyboard:!1}).on("shown.bs.modal",function(){$(this).find(".modal-dialog").css({"max-width":50+$("#forecastexporttable").width()+"px",visibility:"visible"})}).modal("show"),$("#button_export").on("click",function(){i=[];var a=[],o={},t=$("#forecastexporttable tr.selected");$.each(t,function(t,e){a=e.children,o.id=a[1].textContent,o.type=a[2].textContent,o.item=a[3].textContent,o.value=a[4].textContent,o.quantity=a[5].textContent,o.location=a[6].textContent,o.origin=a[7].textContent,o.startdate=a[8].textContent,o.enddate=a[9].textContent,o.criticality=a[10].textContent,i.push(o)}),$("#popup .modal-body").html(gettext("connecting")+"..."),$.ajax({url:url_prefix+"/erp/upload/",data:JSON.stringify(i),type:"POST",contentType:"application/json",success:function(){for(var t in $("#popup .modal-body").html(gettext("Export successful")),$("#cancelbutton").val(gettext("Close")),$("#button_export").toggleClass("btn-primary").prop("disabled",!0),l){"proposed"==s.jqGrid("getCell",l[t],"status")&&s.jqGrid("setCell",l[t],"status","approved")}},error:function(t,e,a){fmts=ngettext("Error during export"),$("#popup .modal-title").html(gettext("Error during export")),$("#popup .modal-header").addClass("bg-danger"),$("#popup .modal-body").css({"overflow-y":"auto"}).html('<div style="overflow-y:auto; height: 300px; resize: vertical">'+t.responseText+"</div>"),$("#button_export").val(gettext("Retry")),$("#popup .modal-dialog").css({visibility:"visible"}),$("#popup").modal("show")}})}),$("#cb_modaltableall").click(function(){$("#forecastexporttable input[type=checkbox]").prop("checked",$(this).prop("checked")),$("#forecastexporttable tbody tr").toggleClass("selected"),0<$("#forecastexporttable tbody input[type=checkbox]:checked").length?$("#button_export").removeClass("active").addClass("active").prop("disabled",!1):$("#button_export").removeClass("active").prop("disabled",!0)}),$("#forecastexporttable tbody input[type=checkbox]").click(function(){$(this).parent().parent().toggleClass("selected"),$("#cb_modaltableall").prop("checked",0==$("#forecastexporttable tbody input[type=checkbox]:not(:checked)").length),0<$("#forecastexporttable tbody input[type=checkbox]:checked").length?$("#button_export").removeClass("active").addClass("active").prop("disabled",!1):$("#button_export").removeClass("active").prop("disabled",!0)}),$("#actions1").html($("#actionsul").children().first().text()+'  <span class="caret"></span>')},error:function(t,e,a){fmts=gettext("Error getting data"),$("#popup .modal-title").html(fmts),$("#popup .modal-header").addClass("bg-danger"),$("#popup .modal-body").css({"overflow-y":"auto"}).html('<div style="overflow-y:auto; height: 300px; resize: vertical">'+t.responseText+"</div>"),$("#button_export").val(gettext("Retry")),$("#popup .modal-dialog").css({visibility:"visible"}),$("#popup").modal("show")}})}}}},dashboard={dragAndDrop:function(){$(".cockpitcolumn").each(function(){Sortable.create($(this)[0],{group:"widgets",handle:".panel-heading",animation:100,onEnd:function(t){dashboard.save()}})}),$("#workarea").each(function(){Sortable.create($(this)[0],{group:"cockpit",handle:"h1",animation:100,onEnd:function(t){dashboard.save()}})}),$(".panel-toggle").click(function(){var t=$(this);t.toggleClass("fa-minus fa-plus"),t.closest(".panel").find(".panel-body").toggle()}),$(".panel-close").click(function(){$(this).closest(".panel").remove(),dashboard.save()})},save:function(t){var e=[];if($("[data-cockpit-row]").each(function(){var t=$(this).attr("data-cockpit-row"),a=[];$(".cockpitcolumn",this).each(function(){var t=12;$(this).hasClass("col-md-12")?t=12:$(this).hasClass("col-md-11")?t=11:$(this).hasClass("col-md-10")?t=10:$(this).hasClass("col-md-9")?t=9:$(this).hasClass("col-md-8")?t=8:$(this).hasClass("col-md-7")?t=7:$(this).hasClass("col-md-6")?t=6:$(this).hasClass("col-md-5")?t=5:$(this).hasClass("col-md-4")?t=4:$(this).hasClass("col-md-3")?t=3:$(this).hasClass("col-md-2")&&(t=2);var e=[];$("[data-cockpit-widget]",this).each(function(){e.push([$(this).attr("data-cockpit-widget"),{}])}),a.push({width:t,widgets:e})}),0<a.length&&e.push({rowname:t,cols:a})}),"undefined"!=typeof url_prefix)var a=url_prefix+"/settings/";else a="/settings/";$.ajax({url:a,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({"freppledb.common.cockpit":e}),success:function(){"string"===$.type(t)&&(window.location.href=window.location.href)},error:function(t,e,a){$("#popup").html('<div class="modal-dialog" style="width: auto"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Error saving report settings")+'</h4></div><div class="modal-body"><p>'+t.responseText+"  "+e+a+'</p></div><div class="modal-footer"></div></div></div>').modal("show")}})},customize:function(t){var e="";$("[data-cockpit-row='"+t+"'] .cockpitcolumn").each(function(){""!=e&&(e+=" - "),$(this).hasClass("col-md-12")?e+="100%":$(this).hasClass("col-md-11")?e+="92%":$(this).hasClass("col-md-10")?e+="83%":$(this).hasClass("col-md-9")?e+="75%":$(this).hasClass("col-md-8")?e+="67%":$(this).hasClass("col-md-7")?e+="58%":$(this).hasClass("col-md-6")?e+="50%":$(this).hasClass("col-md-5")?e+="42%":$(this).hasClass("col-md-4")?e+="33%":$(this).hasClass("col-md-3")?e+="25%":$(this).hasClass("col-md-2")&&(e+="17%")});for(var a='<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Customize a dashboard row")+'</h4></div><div class="modal-body"><form class="form-horizontal"><div class="form-group"><label class="col-md-3 control-label" for="id_name">'+gettext("Name")+':</label><div class="col-md-9"><input id="id_name" class="form-control" type="text" value="'+t+'"></div></div><div class="form-group"><label class="col-md-3 control-label" for="id_layout2">'+gettext("Layout")+':</label><div class="col-md-9 dropdown dropdown-submit-input"><button class="btn btn-default dropdown-toggle" id="id_layout2" name="layout" type="button" data-toggle="dropdown" aria-haspopup="true"><span id="id_layout">'+e+'</span>&nbsp;<span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="id_layout" id="id_layoutul"><li class="dropdown-header">'+gettext("Single column")+'</li><li><a onclick="dashboard.setlayout(this)">100%</a></li><li class="divider"></li><li class="dropdown-header">'+gettext("Two columns")+'</li><li><a onclick="dashboard.setlayout(this)">75% - 25%</a></li><li><a onclick="dashboard.setlayout(this)">67% - 33%</a></li><li><a onclick="dashboard.setlayout(this)">50% - 50%</a></li><li><a onclick="dashboard.setlayout(this)">33% - 67%</a></li><li><a onclick="dashboard.setlayout(this)">25% - 75%</a></li><li class="divider"></li><li class="dropdown-header">'+gettext("Three columns")+'</li><li><a onclick="dashboard.setlayout(this)">50% - 25% - 25%</a></li><li><a onclick="dashboard.setlayout(this)">33% - 33% - 33%</a></li><li class="divider"></li><li class="dropdown-header">'+gettext("Four columns")+'</li><li><a onclick="dashboard.setlayout(this)">25% - 25% - 25% - 25%</a></li></ul></div></div><div class="form-group"><label class="col-md-3 control-label" for="id_widget2">'+gettext("Add widget")+':</label><div class="col-md-9 dropdown dropdown-submit-input"><button class="btn btn-default dropdown-toggle" id="id_widget2" type="button" data-toggle="dropdown"><span id="id_widget">-</span>&nbsp;<span class="caret"></span></button><ul class="dropdown-menu col-sm-9" aria-labelledby="id_widget2" id="id_widgetul">',o=hiddenwidgets.length,i=0;i<o;i++)a+='<li><a onclick="dashboard.setwidget('+i+')">'+hiddenwidgets[i][1]+"</a></li>";a+='</ul></div><span id="newwidgetname" style="display:none"></span></div></form></div><div class="modal-footer"><input type="submit" role="button" onclick=\'dashboard.saveCustomization("'+t+'")\' class="btn btn-danger pull-left" value="'+gettext("Save")+'"><input type="submit" role="button" onclick=\'dashboard.deleteRow("'+t+'")\' class="btn btn-danger pull-left" value="'+gettext("Delete")+'"><input type="submit" role="button" onclick=\'$("#popup").modal("hide")\' class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" role="button" onclick=\'dashboard.addRow("'+t+'", false)\' class="btn btn-primary pull-right" value="'+gettext("Add new below")+'"><input type="submit" role="button" onclick=\'dashboard.addRow("'+t+'", true)\' class="btn btn-primary pull-right" value="'+gettext("Add new above")+'"></div></div></div></div>',$("#popup").html(a).modal("show")},setlayout:function(t){$("#id_layout").text($(t).text())},setwidget:function(t){$("#id_widget").text(hiddenwidgets[t][1]),$("#newwidgetname").text(hiddenwidgets[t][0])},saveCustomization:function(t){var e=$("#id_name").val();if(t!=e){for(var a=2;1<$("[data-cockpit-row='"+e+"']").length;)e=$("#id_name").val()+" - "+a++;$("[data-cockpit-row='"+t+"'] .col-md-11 h1").text(e),$("[data-cockpit-row='"+t+"'] h1 button").attr("onclick","dashboard.customize('"+e+"')"),$("[data-cockpit-row='"+t+"'] .horizontal-form").attr("id",e),$("[data-cockpit-row='"+t+"']").attr("data-cockpit-row",e)}var o=$("#id_layout").text().split("-"),i=0,s=null;for($("[id='"+t+"'] .cockpitcolumn").each(function(){i<o.length?(s=this,$(this).removeClass("col-md-1 col-md-2 col-md-3 col-md-4 col-md-5 col-md-6 col-md-7 col-md-8 col-md-9 col-md-10 col-md-11 col-md-12"),$(this).addClass("col-md-"+Math.round(.12*parseInt(o[i])))):($("[data-cockpit-widget]",this).appendTo(s),$(this).remove()),i++});i<o.length;)s=$('<div class="cockpitcolumn col-md-'+Math.round(.12*parseInt(o[i]))+' col-sm-12"></div>').insertAfter(s),i++;var r=$("#newwidgetname").text();""!=r?($('<div class="panel panel-default" data-cockpit-widget="'+r+'"></div>').appendTo(s),dashboard.save("true")):dashboard.save(),dashboard.dragAndDrop(),$("#popup").modal("hide")},deleteRow:function(t){$("[data-cockpit-row='"+t+"']").remove(),dashboard.save(),$("#popup").modal("hide")},addRow:function(t,e){for(var a=$("#id_name").val(),o=2;1<=$("[data-cockpit-row='"+a+"']").length;)a=$("#id_name").val()+" - "+o++;for(var i='<div class="row" data-cockpit-row="'+a+'"><div class="col-md-11"><h1 style="float: left">'+a+'</h1></div><div class="col-md-1"><h1 class="pull-right"><button class="btn btn-xs btn-primary" onclick="dashboard.customize(\''+a+'\')" data-toggle="tooltip" data-placement="top" data-original-title="'+gettext("Customize")+'"><span class="fa fa-wrench"></span></button></h1></div><div class="horizontal-form" id="'+a+'">',s=$("#id_layout").text().split("-"),r=$("#newwidgetname").text(),l=0;l<s.length;l++)i+='<div class="cockpitcolumn col-md-'+Math.round(.12*parseInt(s[l]))+' col-sm-12">',0==l&&""!=r&&(i+='<div class="panel panel-default" data-cockpit-widget="'+r+'"></div>'),i+="</div>";i+="</div></div></div>",e?$("[data-cockpit-row='"+t+"']").first().before($(i)):$("[data-cockpit-row='"+t+"']").last().after($(i)),""!=r?dashboard.save("true"):dashboard.save(),dashboard.dragAndDrop(),$("#popup").modal("hide")}};function savePreference(t,e,a){if("undefined"!=typeof url_prefix)var o=url_prefix+"/settings/";else o="/settings/";var i={};i[t]=e,$.ajax({url:o,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(i),success:function(){"function"==typeof a&&a()}})}function getToken(){for(var t=document.cookie.split(";"),e=t.length;0<=e;e--)if(0==jQuery.trim(t[e]).indexOf("csrftoken="))return jQuery.trim(jQuery.trim(t[e]).substr(10));return"none"}function sameOrigin(t){var e="//"+document.location.host,a=document.location.protocol+e;return t==a||t.slice(0,a.length+1)==a+"/"||t==e||t.slice(0,e.length+1)==e+"/"||!/^(\/\/|http:|https:).*/.test(t)}function about_show(){$.ajax({url:"/about/",type:"GET",contentType:"application/json",success:function(t){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").modal({keyboard:!1,backdrop:"static"});var e=t.version.split("."),a=t.website,o='<div class="modal-dialog" style="width: 450px;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">About frePPLe '+t.version+' Community Edition</h4></div><div class="modal-body"><div class="row">';for(var i in o+='<div class="col-sm-5"><br><br><p><a target="_blank" href="'+a+'"><strong>frePPLe website &nbsp;<span class="fa fa-caret-right"></span></strong></a></p><br><p><a target="_blank" href="'+a+"/docs/"+e[0]+"."+e[1]+'/license.html"><strong>License information &nbsp;<span class="fa fa-caret-right"></span></strong></a></p><br><p><a target="_blank" href="'+a+"/docs/"+e[0]+"."+e[1]+'/index.html"><strong>Documentation &nbsp;<span class="fa fa-caret-right"></span></strong></a></p></div><div class="col-sm-7"><strong>'+gettext("Installed apps")+":</strong>",t.apps)o+="<br>&nbsp;&nbsp;"+t.apps[i];o+="</div></div></div></div></div>",$("#popup").html(o).modal("show")},error:function(t,e,a){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog style="width: 400px;"><div class="modal-content"><div class="modal-header bg-danger"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">About frePPLe</h4></div><div class="modal-body"><p>'+gettext("Error reading version information")+"</p></div></div></div>").modal("show")}})}function import_show(t,e,a,o,i){var s={abort:function(){}};$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").modal({keyboard:!1,backdrop:"static"});var r='<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title"><span id="modal_title">'+gettext("Import CSV or Excel file")+'</span>&nbsp;<span id="animatedcog" class="fa fa-cog fa-spin fa-2x fa-fw" style="visibility: hidden;"></span></h4></div><div class="modal-body"><form id="uploadform"><p id="extra_text">'+gettext("Load an Excel file or a CSV-formatted text file.")+"<br>"+gettext("The first row should contain the field names.")+'<br><br><input type="checkbox" autocomplete="off" name="erase" value="yes"/>&nbsp;&nbsp;'+gettext("First delete all existing records AND ALL RELATED TABLES")+"<br><br></p>";isDragnDropUploadCapable()?r+='<div class="box" style="outline: 2px dashed black; outline-offset: -10px"><div class="box__input" style="text-align: center; padding: 20px;"><i class="fa fa-sign-in fa-5x fa-rotate-90"></i><input class="box__file invisible" type="file" id="csv_file" name="csv_file" data-multiple-caption="{count} '+gettext("files selected")+'" multiple/><label id="uploadlabel" for="csv_file"><kbd>'+gettext("Select files")+'</kbd>&nbsp;<span class="box__dragndrop" style="display: inline;">'+gettext("or drop them here")+'</span>.</label></div><div class="box__uploading" style="display: none;">Uploading&hellip;</div><div class="box__success" style="display: none;">Done!</div><div class="box__error" style="display: none;">Error!<span></span>.</div></div>':r+=gettext("Data file")+':<input type="file" id="csv_file" name="csv_file"/>',r+='<br></form><div style="margin: 5px 0"><div id="uploadResponse" style="height: 50vh; resize: vertical; display: none; background-color: inherit; border: none; overflow: auto;"></div></div></div><div class="modal-footer"><input type="submit" id="importbutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Import")+'"><input type="submit" id="cancelimportbutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Cancel Import")+'" style="display: none;"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Close")+'"><input type="submit" id="copytoclipboard" role="button" class="btn btn-primary pull-left" value="'+gettext("Copy to Clipboard")+'" style="display: none;"></div></div></div>',$("#popup").html(r).modal("show"),a||$("#selected_files").removeAttr(a),""!==t&&$("#modal_title").text(t),null===e?$("#extra_text").remove():""!==e&&$("#extra_text").text(e);var l=!1,n=!1;isDragnDropUploadCapable()&&$(".box").on("drag dragstart dragend dragover dragenter dragleave drop",function(t){t.preventDefault(),t.stopPropagation()}).on("dragover dragenter",function(){$(".box").removeClass("bg-warning").addClass("bg-warning")}).on("dragleave dragend drop",function(){$(".box").removeClass("bg-warning")}).on("drop",function(t){l=a?t.originalEvent.dataTransfer.files:[t.originalEvent.dataTransfer.files[0]],$("#uploadlabel").text(1<l.length?($("#csv_file").attr("data-multiple-caption")||"").replace("{count}",l.length):l[0].name)}),$("#csv_file").on("change",function(t){n=a?t.target.files:[t.target.files[0]],$("#uploadlabel").text(1<n.length?($("#csv_file").attr("data-multiple-caption")||"").replace("{count}",n.length):n[0].name)}),null!=i&&(l=a?i:[i[0]],$("#uploadlabel").text(1<l.length?($("#csv_file").attr("data-multiple-caption")||"").replace("{count}",l.length):l[0].name)),$("#importbutton").on("click",function(){if(""!==$("#csv_file").val()||l){var a="";$("#uploadResponse").css("display","block"),$("#uploadResponse").html(gettext("Importing...")),$("#uploadResponse").on("scroll",function(){parseInt($("#uploadResponse").attr("data-scrolled"))!==$("#uploadResponse").scrollTop()&&($("#uploadResponse").attr("data-scrolled",!0),$("#uploadResponse").off("scroll"))}),$("#importbutton").hide(),$("#animatedcog").css("visibility","visible"),$("#uploadform").css("display","none"),$("#copytoclipboard").on("click",function(){var t=document.createRange();t.selectNode(document.getElementById("uploadResponse")),window.getSelection().removeAllRanges(),window.getSelection().addRange(t),document.execCommand("copy")}),$("#cancelimportbutton").show().on("click",function(){var t=$("#uploadResponse").clone();t.append("<div><strong>"+gettext("Canceled")+"</strong></div>"),s.abort(),$("#animatedcog").css("visibility","hidden"),$("#uploadResponse").append(t.contents()),$("#uploadResponse").scrollTop($("#uploadResponse")[0].scrollHeight),$("#cancelimportbutton").hide(),$("#copytoclipboard").show()}),a=new FormData($("#uploadform")[0]),l&&$.each(l,function(t,e){a.append(e.name,e)}),n&&(a.delete("csv_file"),$.each(n,function(t,e){a.append(e.name,e)})),s=$.ajax(Object.assign({type:"post",url:"undefined"!=typeof url?url:"",cache:!1,data:a,success:function(t){var e=$("#uploadResponse");e.html(t),"true"!==e.attr("data-scrolled")&&e.scrollTop(e[0].scrollHeight-e.height()),$("#cancelbutton").html(gettext("Close")),$("#importbutton").hide(),$("#animatedcog").css("visibility","hidden"),$("#cancelimportbutton").hide(),document.queryCommandSupported("copy")&&$("#copytoclipboard").show(),$("#grid").trigger("reloadGrid")},xhrFields:{onprogress:function(t){var e=$("#uploadResponse");e.html(t.currentTarget.response),"true"!==e.attr("data-scrolled")&&(e.attr("data-scrolled",e[0].scrollHeight-e.height()),e.scrollTop(e[0].scrollHeight-e.height()))}},error:function(){$("#cancelimportbutton").hide(),$("#copytoclipboard").show(),$("#animatedcog").css("visibility","hidden"),$("#uploadResponse").scrollTop($("#uploadResponse")[0].scrollHeight)},processData:!1,contentType:!1},o))}})}function getURLparameters(){if(0==window.location.search.length)return{};var a={};return jQuery.each(window.location.search.match(/^\??(.*)$/)[1].split("&"),function(t,e){(e=e.split("="))[1]=unescape(e[1]).replace(/\+/g," "),a[e[0]]=a[e[0]]?a[e[0]]instanceof Array?(a[e[0]].push(e[1]),a[e[0]]):[a[e[0]],e[1]]:e[1]}),a}function selectDatabase(){var t=$(this).attr("data-database");database!=t&&("default"==database?"/"==window.location.pathname?window.location.href="/"+t+"/":window.location.href=window.location.href.replace(window.location.pathname,"/"+t+window.location.pathname):window.location.href="default"==t?window.location.href.replace("/"+database+"/","/"):window.location.href.replace("/"+database+"/","/"+t+"/"))}$(function(){$(document).ajaxSend(function(t,e,a){!/^(GET|HEAD|OPTIONS|TRACE)$/.test(a.type)&&sameOrigin(a.url)&&e.setRequestHeader("X-CSRFToken",getToken())}),$.ajaxSetup({cache:!1});var t=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:url_prefix+"/search/?term=%QUERY",wildcard:"%QUERY"}});$("#search").typeahead({minLength:2},{limit:1e3,highlight:!0,name:"search",display:"value",source:t,templates:{suggestion:function(t){return null===t.value?'<span><p style="margin-top: 5px; margin-bottom: 1px;">'+t.label+'</p><li  role="separator" class="divider"></li></span>':'<li><a style="display: block" href="'+url_prefix+t.url+admin_escape(t.value)+'/" >'+t.value+"</a></li>"}}})}),$.fn.bindFirst=function(a,t){this.on(a,t),this.each(function(){var t=$._data(this,"events")[a.split(".")[0]],e=t.pop();t.splice(0,0,e)})};var graph={header:function(t,e){var a=$("#grid_graph");a.html("");var o=e.range(),i=e.rangeBand(),s=d3.select(a.get(0)).append("svg");s.attr("height","15px"),s.attr("width",a.width());var r=0;for(var l in timebuckets){var n=t+o[l]+i/2;if(r<=n)r=n+s.append("text").attr("class","svgheadertext").attr("x",n).attr("y","12").text(timebuckets[l].name).node().getComputedTextLength()+12}},showTooltip:function(t){var e=d3.select("#tooltip");e.empty()&&(e=d3.select("body").append("div").attr("id","tooltip").attr("role","tooltip").attr("class","popover fade right in").style("position","absolute")),e.html(""+t).style("display","block"),graph.moveTooltip()},hideTooltip:function(){d3.select("#tooltip").style("display","none"),d3.event.stopPropagation()},moveTooltip:function(){var t=d3.event.pageX+5,e=d3.event.pageY-28,a=$(window).width()-$("#tooltip").width()-20,o=$(window).height()-$("#tooltip").height()-20;a<t&&(t=a,e=d3.event.pageY+5),o<e&&(e=d3.event.pageY-$("#tooltip").height()-25),d3.select("#tooltip").style({left:t+"px",top:e+"px"}),d3.event.stopPropagation()},miniAxis:function(t){var e=this.scale().range(),a=this.scale().domain();t.append("path").attr("class","domain").attr("d","M-10 0 H0 V"+(e[0]-2)+" H-10"),t.append("text").attr("x",-2).attr("y",13).attr("text-anchor","end").text(grid.formatNumber(Math.round(a[1]))),t.append("text").attr("x",-2).attr("y",e[0]-5).attr("text-anchor","end").text(Math.round(a[0],0))}},gantt={startmousemove:null,resizing:null,rowsize:25,header:function(){var t=864e5/(viewend.getTime()-viewstart.getTime())*$("#jqgh_grid_operationplans").width(),e=['<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="34px">','<line class="time" x1="0" y1="17" x2="'+$("#jqgh_grid_operationplans").width()+'" y2="17"/>'],a=0;if(t<5)for(var o=new Date(viewstart.getFullYear(),viewstart.getMonth(),1);o<viewend;){var i=(o.getTime()-viewstart.getTime())/864e5*t,s=new Date(o.getFullYear(),o.getMonth()+1,1),r=(s.getTime()-viewstart.getTime())/864e5*t;if(e.push('<text class="svgheadertext" x="'+Math.floor((i+r)/2)+'" y="31">'+moment(o).format("MMM")+"</text>"),o.getMonth()%3==0){r=(new Date(o.getFullYear(),o.getMonth()+3,1).getTime()-viewstart.getTime())/864e5*t;var l=Math.floor((o.getMonth()+3)/3);e.push('<line class="time" x1="'+Math.floor(i)+'" y1="0" x2="'+Math.floor(i)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor((i+r)/2)+'" y="13">'+o.getFullYear()+" Q"+l+"</text>")}else e.push('<line class="time" x1="'+Math.floor(i)+'" y1="17" x2="'+Math.floor(i)+'" y2="34"/>');o=s}else if(t<10){a-=viewstart.getDay()*t;for(o=new Date(viewstart.getTime()-864e5*viewstart.getDay());o<viewend;)e.push('<line class="time" x1="'+Math.floor(a)+'" y1="17" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+3.5*t)+'" y="31">'+moment(o).format("MM-DD")+"</text>"),a+=7*t,o.setTime(o.getTime()+6048e5);for(o=new Date(viewstart.getFullYear(),viewstart.getMonth(),1);o<viewend;)i=(o.getTime()-viewstart.getTime())/864e5*t,r=((s=new Date(o.getFullYear(),o.getMonth()+1,1)).getTime()-viewstart.getTime())/864e5*t,e.push('<line class="time" x1="'+Math.floor(i)+'" y1="0" x2="'+Math.floor(i)+'" y2="17"/>'),e.push('<text class="svgheadertext" x="'+Math.floor((i+r)/2)+'" y="13">'+moment(o).format("MMM YY")+"</text>"),o=s}else if(t<20){a-=viewstart.getDay()*t;for(o=new Date(viewstart.getTime()-864e5*viewstart.getDay());o<viewend;)e.push('<line class="time" x1="'+Math.floor(a)+'" y1="17" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+(a+7*t/2)+'" y="31">'+moment(o).format("YY-MM-DD")+"</text>"),a+=7*t,o.setTime(o.getTime()+6048e5);for(o=new Date(viewstart.getFullYear(),viewstart.getMonth(),1);o<viewend;)i=(o.getTime()-viewstart.getTime())/864e5*t,r=((s=new Date(o.getFullYear(),o.getMonth()+1,1)).getTime()-viewstart.getTime())/864e5*t,e.push('<line class="time" x1="'+Math.floor(i)+'" y1="0" x2="'+Math.floor(i)+'" y2="17"/>'),e.push('<text class="svgheadertext" x="'+Math.floor((i+r)/2)+'" y="13">'+moment(o).format("MMM YY")+"</text>"),o=s}else if(t<=40)for(o=new Date(viewstart.getTime());o<viewend;)0==o.getDay()?(e.push('<line class="time" x1="'+Math.floor(a)+'" y1="0" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+7*t/2)+'" y="13">'+moment(o).format("YY-MM-DD")+"</text>")):e.push('<line class="time" x1="'+Math.floor(a)+'" y1="17" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+t/2)+'" y="31">'+moment(o).format("DD")+"</text>"),a+=t,o.setDate(o.getDate()+1);else if(t<=75)for(o=new Date(viewstart.getTime());o<viewend;)0==o.getDay()?(e.push('<line class="time" x1="'+Math.floor(a)+'" y1="0" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+7*t/2)+'" y="13">'+moment(o).format("YY-MM-DD")+"</text>")):e.push('<line class="time" x1="'+Math.floor(a)+'" y1="17" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+t/2)+'" y="31">'+moment(o).format("DD MM")+"</text>"),a+=t,o.setDate(o.getDate()+1);else if(t<350)for(o=new Date(viewstart.getTime());o<viewend;)0==o.getDay()?(e.push('<line class="time" x1="'+Math.floor(a)+'" y1="0" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+3.5*t)+'" y="13">'+moment(o).format("YY-MM-DD")+"</text>")):e.push('<line class="time" x1="'+Math.floor(a)+'" y1="17" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+t/2)+'" y="31">'+moment(o).format("ddd DD MMM")+"</text>"),a+=t,o.setDate(o.getDate()+1);else for(o=new Date(viewstart.getTime());o<viewend;)0==o.getHours()?(e.push('<line class="time" x1="'+Math.floor(a)+'" y1="0" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+t/2)+'" y="13">'+moment(o).format("ddd YY-MM-DD")+"</text>")):e.push('<line class="time" x1="'+Math.floor(a)+'" y1="17" x2="'+Math.floor(a)+'" y2="34"/>'),e.push('<text class="svgheadertext" x="'+Math.floor(a+t/48)+'" y="31">'+o.getHours()+"</text>"),a+=t/24,o.setTime(o.getTime()+36e5);e.push("</svg>"),$("#jqgh_grid_operationplans").html(e.join("")).unbind("mousedown").bind("mousedown",function(t){gantt.startmousemove=t.pageX,$(window).bind("mouseup",function(t){$(window).unbind("mousemove"),$(window).unbind("mouseup"),t.stopPropagation()}),$(window).bind("mousemove",function(t){var e=t.pageX-gantt.startmousemove;3<Math.abs(e)&&(gantt.zoom(1,0<e?-864e5:864e5),gantt.startmousemove=t.pageX),t.stopPropagation()}),t.stopPropagation()})},reset:function(){var e=$("#jqgh_grid_operationplans").width()/1e4;viewstart=new Date(horizonstart.getTime()),viewend=new Date(horizonend.getTime()),$(".transformer").each(function(){var t=$(this).attr("title");$(this).attr("transform","scale("+e+",1) translate(0,"+((t-1)*gantt.rowsize+3)+")")}),gantt.header()},redraw:function(){var e=(horizonend.getTime()-horizonstart.getTime())/(viewend.getTime()-viewstart.getTime())*$("#jqgh_grid_operationplans").width()/1e4;$(".transformer").each(function(){var t=$(this).attr("title");$(this).attr("transform","scale("+e+",1) translate(0,"+((t-1)*gantt.rowsize+3)+")")}),gantt.header()},zoom:function(t,e){var a=Math.min(1095,Math.max(1,Math.ceil((viewend.getTime()-viewstart.getTime())/864e5*t)));viewstart.setTime(viewstart.getTime()+e),viewend.setTime(viewstart.getTime()+864e5*a);var o=(horizonend.getTime()-horizonstart.getTime())/(864e6*a)*$("#jqgh_grid_operationplans").width()/1e3,i=(horizonstart.getTime()-viewstart.getTime())/(horizonend.getTime()-horizonstart.getTime())*1e4;$(".transformer").each(function(){var t=$(this).attr("title");$(this).attr("transform","scale("+o+",1) translate("+i+","+((t-1)*gantt.rowsize+3)+")")}),gantt.header()}},tour={autoplay:0,tooltip:null,chapter:0,step:0,intro:null,timeout:null,tooltip:'<div class="popover tourpopover" role="tooltip"><div class="arrow"></div><div class="popover-content"></div></div>',introtip:'<div class="popover tourpopover" role="tooltip"><div class="arrow"></div><div class="popover-content" style="padding-bottom: 0"></div><div class="popover-footer small"><label><input style="vertical-align: bottom" type="checkbox" checked onclick="tour.displayHints(this.checked, true)">&nbsp;'+gettext("Show hints")+"</label></div></div>",displayHints:function(t,e){t?(localStorage.removeItem("intro"),$("#showHints").addClass("toggle-on").removeClass("toggle-off"),tour.showIntroPage(null)):(localStorage.setItem("intro","{}"),$("#showHints").addClass("toggle-off").removeClass("toggle-on"),$(".tourpopover").popover("destroy"))},showIntroPage:function(t){if(null==t){var e={};for(var a in introdata)e[a]=0;localStorage.setItem("intro",JSON.stringify(e))}else{""==t&&(t=localStorage.getItem("intro"));e=JSON.parse(t)}location.pathname in e?(tour.intro=introdata[location.pathname][e[location.pathname]],tour.showStep(),tour.intro=null,$("html").on("click",function(t){$(t.target).is("a")||tour.showIntroPage("")}),e[location.pathname]+=1,e[location.pathname]>=introdata[location.pathname].length&&delete e[location.pathname],localStorage.setItem("intro",JSON.stringify(e))):$(".tourpopover").popover("destroy")},start:function(t){var e=t.split(",");tour.chapter=parseInt(e[0]),tour.step=parseInt(e[1]),tour.autoplay=parseInt(e[2]),$.ajax({url:"/static/js/i18n/tour.en.js",dataType:"script",cache:!0,success:tour.init,fail:function(){console.log("Error loading the tutorial: "+arguments[2].toString())}})},init:function(){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").removeClass("in").addClass("tourguide").html('<div class="modal-dialog" id="tourModal" role="dialog" style="width: 600px; position: absolute; top: 30px; bottom: 10px; left: auto; right: 15px;"><div class="modal-content"><div class="modal-header"><h4 id="modalTitle" class="modal-title"><strong>'+gettext("Guided tour")+'</strong><button type="button" id="tourcancelbutton" class="close" data-dismiss="modal" aria-hidden="true"><span class="fa fa-times"</button></h4></div><div class="modal-body" id="tourmodalbody" style="padding-bottom:20px;">'+tourdata[tour.chapter].description+"</div></div></div>").modal({}).on("hidden.bs.modal",function(){$(".tourpopover").popover("destroy")}).on("shown.bs.modal",function(){tour.showStep()}).modal("show"),$("#tourmodalbody").append('<div id="tour" style="padding-bottom:20px; display:none">'+tourdata[tour.chapter].description+"<br><br><br></div>"),$("#tourprevious").on("click",function(){tour.prev()}),$("#playbutton").on("click",function(){tour.toggleAutoplay()}),$("#tournext").on("click",function(){tour.next()}),$("#tourcancelbutton").on("click",function(){$(".tourpopover").popover("destroy"),$("#tourModal").modal("hide")})},next:function(){$(tourdata[tour.chapter].steps[tour.step].element).popover("destroy"),tour.step++,tour.step>=tourdata[tour.chapter].steps.length&&(tour.chapter++,tour.step=0,tour.chapter>=tourdata.length&&(tour.chapter=0)),tour.showStep()},prev:function(){if($(tourdata[tour.chapter].steps[tour.step].element).popover("destroy"),tour.step--,tour.step<0){if(tour.chapter--,tour.chapter<0)return tour.step=0,void(tour.chapter=0);tour.step=tourdata[tour.chapter].steps.length-1}tour.showStep()},showStep:function(){if($(".tourpopover").popover("destroy"),tour.intro)var stepData=tour.intro;else{var stepData=tourdata[tour.chapter].steps[tour.step],nexthref="",currsearch="";if(currsearch=-1<location.search.lastIndexOf("&")?location.search.replace(location.search.slice(location.search.lastIndexOf("&")),""):"",location.pathname+currsearch!=url_prefix+stepData.url)return nexthref=url_prefix+stepData.url+"?tour="+tour.chapter+","+tour.step+","+tour.autoplay,2==nexthref.match(/\?/g).length&&(nexthref=url_prefix+stepData.url+"&tour="+tour.chapter+","+tour.step+","+tour.autoplay),void(window.location.href=nexthref)}"beforestep"in stepData&&eval(stepData.beforestep);var tooltipPos=void 0===stepData.position?"BL":stepData.position;$(stepData.element).attr("role","button").attr("tabindex","0"),$(stepData.element).popover({html:!0,container:"body",template:tour.intro?tour.introtip:tour.tooltip,title:"",content:stepData.description,placement:stepData.position,trigger:"manual"}),$(stepData.element).popover("show").on("shown.bs.popover",function(){var t=$(".tourpopover").css("top").replace("px","");(t<window.pageYOffset||t>window.pageYOffset+window.innerHeight/2)&&window.scrollTo(0,t-window.innerHeight/2)}),null==tour.intro&&($("#tourmodalbody").html(tourdata[tour.chapter].description),0==tour.chapter&&0==tour.step?$("#tourprevious").prop("disabled",!0):$("#tourprevious").prop("disabled",!1),tour.chapter>=tourdata.length-1&&tour.step>=tourdata[tour.chapter].steps.length-1?$("#tournext").prop("disabled",!0):$("#tournext").prop("disabled",!1),tour.autoplay&&(tour.timeout=setTimeout(tour.next,1e3*tourdata[tour.chapter].delay))),"afterstep"in stepData&&eval(stepData.afterstep)},toggleAutoplay:function(){0<tour.autoplay?($("#playbutton").html(gettext("Play")+'&nbsp;<span class="fa fa-play"></span>'),tour.autoplay=0,clearTimeout(tour.timeout),tour.timeout=null):($("#playbutton").html(gettext("Pause")+'&nbsp;<span class="fa fa-pause"></span>'),tour.autoplay=1,tour.next())}};function Gauge(t,e){this.placeholderName=t;var h=this;this.configure=function(t){this.config=t,this.config.size=.9*this.config.size,this.config.raduis=.97*this.config.size/2,this.config.cx=this.config.size/2,this.config.cy=this.config.size/2,this.config.min=null!=t.min?t.min:0,this.config.max=null!=t.max?t.max:100,this.config.range=this.config.max-this.config.min,this.config.majorTicks=t.majorTicks||5,this.config.minorTicks=t.minorTicks||2,this.config.greenColor=t.greenColor||"#109618",this.config.yellowColor=t.yellowColor||"#FF9900",this.config.redColor=t.redColor||"#DC3912",this.config.transitionDuration=t.transitionDuration||500},this.render=function(){for(var t in this.body=d3.select("#"+this.placeholderName).append("svg:svg").attr("class","gauge").attr("width",this.config.size).attr("height",this.config.size),this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",this.config.raduis).style("fill","#ccc").style("stroke","#000").style("stroke-width","0.5px"),this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.9*this.config.raduis).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width","2px"),this.config.greenZones)this.drawBand(this.config.greenZones[t].from,this.config.greenZones[t].to,h.config.greenColor);for(var t in this.config.yellowZones)this.drawBand(this.config.yellowZones[t].from,this.config.yellowZones[t].to,h.config.yellowColor);for(var t in this.config.redZones)this.drawBand(this.config.redZones[t].from,this.config.redZones[t].to,h.config.redColor);if(null!=this.config.label){var e=Math.round(this.config.size/9);this.body.append("svg:text").attr("x",this.config.cx).attr("y",this.config.cy/2+e/2).attr("dy",e/2).attr("text-anchor","middle").text(this.config.label).style("font-size",e+"px").style("fill","#333").style("stroke-width","0px")}e=Math.round(this.config.size/16);for(var a=this.config.range/(this.config.majorTicks-1),o=this.config.min;o<=this.config.max;o+=a){for(var i=a/this.config.minorTicks,s=o+i;s<Math.min(o+a,this.config.max);s+=i){var r=this.valueToPoint(s,.75),l=this.valueToPoint(s,.85);this.body.append("svg:line").attr("x1",r.x).attr("y1",r.y).attr("x2",l.x).attr("y2",l.y).style("stroke","#666").style("stroke-width","1px")}r=this.valueToPoint(o,.7),l=this.valueToPoint(o,.85);if(this.body.append("svg:line").attr("x1",r.x).attr("y1",r.y).attr("x2",l.x).attr("y2",l.y).style("stroke","#333").style("stroke-width","2px"),o==this.config.min||o==this.config.max){var n=this.valueToPoint(o,.63);this.body.append("svg:text").attr("x",n.x).attr("y",n.y).attr("dy",e/3).attr("text-anchor",o==this.config.min?"start":"end").text(o).style("font-size",e+"px").style("fill","#333").style("stroke-width","0px")}}var d=this.body.append("svg:g").attr("class","pointerContainer"),c=(this.config.min+this.config.max)/2,p=this.buildPointerPath(c),u=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("basis");d.selectAll("path").data([p]).enter().append("svg:path").attr("d",u).style("fill","#dc3912").style("stroke","#c63310").style("fill-opacity",.7),d.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.12*this.config.raduis).style("fill","#4684EE").style("stroke","#666").style("opacity",1);e=Math.round(this.config.size/10);d.selectAll("text").data([c]).enter().append("svg:text").attr("x",this.config.cx).attr("y",this.config.size-this.config.cy/4-e).attr("dy",e/2).attr("text-anchor","middle").style("font-size",e+"px").style("fill","#000").style("stroke-width","0px"),this.redraw(this.config.value,0)},this.buildPointerPath=function(t){var e=this.config.range/13,a=n(t,.85),o=n(t-e,.12),i=n(t+e,.12),s=t-this.config.range*(1/.75)/2,r=n(s,.28),l=n(s-e,.12);return[a,o,n(s+e,.12),r,l,i,a];function n(t,e){var a=h.valueToPoint(t,e);return a.x-=h.config.cx,a.y-=h.config.cy,a}},this.drawBand=function(t,e,a){e-t<=0||this.body.append("svg:path").style("fill",a).attr("d",d3.svg.arc().startAngle(this.valueToRadians(t)).endAngle(this.valueToRadians(e)).innerRadius(.65*this.config.raduis).outerRadius(.85*this.config.raduis)).attr("transform",function(){return"translate("+h.config.cx+", "+h.config.cy+") rotate(270)"})},this.redraw=function(e,t){var a=this.body.select(".pointerContainer");a.selectAll("text").text(Math.round(e)),a.selectAll("path").transition().duration(null!=t?t:this.config.transitionDuration).attrTween("transform",function(){var t=e;e>h.config.max?t=h.config.max+.02*h.config.range:e<h.config.min&&(t=h.config.min-.02*h.config.range);var a=h.valueToDegrees(t)-90,o=h._currentRotation||a;return h._currentRotation=a,function(t){var e=o+(a-o)*t;return"translate("+h.config.cx+", "+h.config.cy+") rotate("+e+")"}})},this.valueToDegrees=function(t){return t/this.config.range*270-(this.config.min/this.config.range*270+45)},this.valueToRadians=function(t){return this.valueToDegrees(t)*Math.PI/180},this.valueToPoint=function(t,e){return{x:this.config.cx-this.config.raduis*e*Math.cos(this.valueToRadians(t)),y:this.config.cy-this.config.raduis*e*Math.sin(this.valueToRadians(t))}},this.configure(e)}function showModalImage(t,e){var a=$("#popup");a.html('<div class="modal-dialog modal-lg" style="margin-top: 20px; width:90%; margin-left: auto; margin-right: auto"><div class="modal-content"><div class="modal-header" style="border-top-left-radius: inherit; border-top-right-radius: inherit"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title"></h4></div><div class="modal-body"><img src="" style="width:100%"></div></div></div>'),a.find("h4").text(e),a.find("img").attr("src",$(t.target).attr("src")),a.modal("show"),t.preventDefault()}
//# sourceMappingURL=frepple.min.js.map