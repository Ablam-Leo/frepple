/* frePPLe 4.0.0 2017-04-27
Copyright (C) 2010-2017 by frePPLe bvba

This library is free software; you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as published
by the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
General Public License for more details.

You should have received a copy of the GNU Affero General Public
License along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

"use strict";function operationplanCtrl(a,b){function c(c){function d(a){return void 0===c?a:(void 0!==c.startdate&&""!==c.startdate&&(a.start=c.startdate),void 0!==c.enddate&&""!==c.enddate&&(a.end=c.enddate),void 0!==c.quantity&&""!==c.quantity&&(a.quantity=parseInt(c.quantity)),void(void 0!==c.status&&""!==c.status&&(a.status=c.status)))}var e="undefined"==typeof c?void 0:c.id;a.operationplan=new b,"undefined"!=typeof c&&(c.hasOwnProperty("operationplan__id")?(e=c.operationplan__id,a.operationplan.editable=!1):a.operationplan.editable=!0),a.operationplan.id="undefined"==typeof e?void 0:parseInt(e),a.operationplan.get(d).catch(function(a){errorPopup(a.data)})}function d(b){"no_action"!==b&&a.$apply(function(){a.operationplan.status=b})}function e(b,c,d){angular.element(document).find("#"+a.operationplan.id).removeClass("edited").addClass("edited"),b===a.operationplan.id.toString()&&("startdate"===c&&a.$apply(function(){a.operationplan.start=d}),"enddate"===c&&a.$apply(function(){a.operationplan.end=d}),"quantity"===c&&a.$apply(function(){a.operationplan.quantity=parseInt(d)}),"status"===c&&a.refreshstatus(d))}a.test="angular controller",a.operationplan=new b,a.displayongrid=displayongrid,"function"==typeof a.displayongrid&&a.$watchGroup(["operationplan.id","operationplan.start","operationplan.end","operationplan.quantity","operationplan.status"],function(b,c){c[0]===b[0]&&"undefined"!=typeof c[0]&&("undefined"!=typeof c[1]&&"undefined"!=typeof b[1]&&c[1]!==b[1]&&a.displayongrid(a.operationplan.id,"startdate",a.operationplan.start),"undefined"!=typeof c[2]&&"undefined"!=typeof b[2]&&c[2]!==b[2]&&a.displayongrid(a.operationplan.id,"enddate",a.operationplan.end),"undefined"!=typeof c[3]&&"undefined"!=typeof b[3]&&c[3]!==b[3]&&a.displayongrid(a.operationplan.id,"quantity",a.operationplan.quantity),"undefined"!=typeof c[4]&&"undefined"!=typeof b[4]&&c[4]!==b[4]&&a.displayongrid(a.operationplan.id,"status",a.operationplan.status)),c[0]=b[0]}),a.displayInfo=c,a.refreshstatus=d,a.displayonpanel=e}function showproblemspanelDrv(a){function b(a,b,c){var d='<table class="table"><thead><tr><td><b style="text-transform: capitalize;">'+gettext("problems")+'</b></td><td><b style="text-transform: capitalize;">'+gettext("start")+'</b></td><td><b style="text-transform: capitalize;">'+gettext("end")+"</b></td></tr></thead><tbody></tbody></table>";a.$watchGroup(["operationplan.id","operationplan.problems.length"],function(b,c){angular.element(document).find("#attributes-operationproblems").empty().append(d);var e='<tr><td colspan="3">'+gettext("no problems")+"</td></tr>";"undefined"!=typeof a.operationplan&&a.operationplan.hasOwnProperty("problems")&&(e="",angular.forEach(a.operationplan.problems,function(a){e+="<tr><td>"+a.description+"</td>"+a.start+"<td></td>"+a.end+"<td></tr>"})),angular.element(document).find("#attributes-operationproblems tbody").append(e)})}var c={restrict:"EA",scope:{operationplan:"=data"},link:b};return c}function showresourcespanelDrv(a){function b(a,b,c){var d='<table class="table"><thead><tr><td><b style="text-transform: capitalize;">'+gettext("resource")+'</b></td><td><b style="text-transform: capitalize;">'+gettext("quantity")+"</b></td><tbody></tbody></table>";a.$watchGroup(["operationplan.id","operationplan.loadplans.length"],function(b,c){angular.element(document).find("#attributes-operationresources").empty().append(d);var e='<tr><td colspan="2">'+gettext("no resources")+"</td></tr>";"undefined"!=typeof a.operationplan&&a.operationplan.hasOwnProperty("loadplans")&&(e="",angular.forEach(a.operationplan.loadplans,function(a){e+="<tr><td>"+a.resource.name+"</td><td>"+a.quantity+"</td></tr>"})),angular.element(document).find("#attributes-operationresources tbody").append(e)})}var c={restrict:"EA",scope:{operationplan:"=data"},link:b};return c}function showbufferspanelDrv(a){function b(a,b,c,d){var e='<table class="table"><thead><tr><td><b style="text-transform: capitalize;">'+gettext("buffer")+'</b></td><td><b style="text-transform: capitalize;">'+gettext("quantity")+'</b></td><td><b style="text-transform: capitalize;">'+gettext("onhand")+'</b></td><td><b style="text-transform: capitalize;">'+gettext("date")+"</b></td></tr></thead><tbody></tbody></table>";a.$watchGroup(["operationplan.id","operationplan.flowplans.length"],function(b,c){angular.element(document).find("#attributes-operationflowplans").empty().append(e);var d='<tr><td colspan="3">'+gettext("no movements")+"<td></tr>";"undefined"!=typeof a.operationplan&&a.operationplan.hasOwnProperty("flowplans")&&(d="",angular.forEach(a.operationplan.flowplans,function(a){d+="<tr><td>"+a.buffer.name+"</td><td>"+a.quantity+"</td><td>"+a.onhand+"</td><td>"+a.date+"</td></tr>"})),angular.element(document).find("#attributes-operationflowplans tbody").append(d)})}var c={restrict:"EA",scope:{operationplan:"=data"},link:b};return c}function showoperationpeggingpanelDrv(a){function b(a,b,c,d){var e='<table class="table"><thead><tr><td><b style="text-transform: capitalize;">'+gettext("demand")+'</b></td><td><b style="text-transform: capitalize;">'+gettext("quantity")+"</b></td><tbody></tbody></table>";a.$watchGroup(["operationplan.id","operationplan.pegging_demand.length"],function(b,c){angular.element(document).find("#attributes-operationdemandpegging").empty().append(e);var d='<tr><td colspan="2">'+gettext("no demands")+"</td></tr>";"undefined"!=typeof a.operationplan&&a.operationplan.hasOwnProperty("pegging_demand")&&(d="",angular.forEach(a.operationplan.pegging_demand,function(a){d+="<tr><td>"+a.demand.name+"</td><td>"+a.quantity+"</td></tr>"})),angular.element(document).find("#attributes-operationdemandpegging tbody").append(d)})}var c={restrict:"EA",scope:{operationplan:"=data"},link:b};return c}function showoperationplanDrv(a){function b(a,b,c){a.opptype={MO:gettext("Manufacturing Order"),PO:gettext("Purchase Order"),DO:gettext("Distribution Order"),STCK:gettext("Stock"),DLVR:gettext("Delivery")},a.$watchGroup(["operationplan.id","operationplan.start","operationplan.end","operationplan.quantity","operationplan.criticality","operationplan.delay","operationplan.status"],function(c,d){"undefined"==typeof a.operationplan.id||isNaN(a.operationplan.id)?(angular.element(b).find("input").attr("disabled","disabled"),angular.element(b).find("#statusrow .btn").removeClass("active").attr("disabled","disabled"),angular.element(b).find("#setStart").val(""),angular.element(b).find("#setEnd").val("")):(angular.element(b).find("input[disabled]").attr("disabled",!1),angular.element(b).find("button[disabled]").attr("disabled",!1),angular.element(b).find("#statusrow .btn").removeClass("active"),a.operationplan.hasOwnProperty("start")&&angular.element(b).find("#setStart").val(moment(a.operationplan.start).format("YYYY-MM-DD HH:mm:ss")),a.operationplan.hasOwnProperty("end")&&angular.element(b).find("#setEnd").val(moment(a.operationplan.end).format("YYYY-MM-DD HH:mm:ss")),a.operationplan.hasOwnProperty("status")&&(angular.element(b).find("#statusrow .btn").removeClass("active"),angular.element(b).find("#"+a.operationplan.status+"Btn").addClass("active"))),a.operationplan.editable||(angular.element(b).find("input").attr("disabled","disabled").css("cursor","default"),angular.element(b).find("#statusrow .btn").attr("disabled","disabled"))}),angular.element(b).find(".vDateField").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!1,calendarWeeks:!0,minDate:"2000-01-01",inline:!1,sideBySide:!0,icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-bullseye",clear:"fa fa-trash",close:"fa fa-remove"},locale:language,widgetPositioning:{horizontal:"left",vertical:"bottom"}}).on("dp.change",function(b){b.oldDate&&b.date!=b.oldDate&&("setStart"===b.target.id&&a.$apply(function(){a.operationplan.start=new moment(b.date).format("YYYY-MM-DDTHH:mm:ss")}),"setEnd"===b.target.id&&a.$apply(function(){a.operationplan.end=new moment(b.date).format("YYYY-MM-DDTHH:mm:ss")}))}).on("$destroy",function(){void 0!==$(this).data("DateTimePicker")&&$(this).data("DateTimePicker").destroy()})}var c={restrict:"EA",scope:{operationplan:"=data"},templateUrl:"/static/operationplandetail/operationplanpanel.html",link:b};return c}var operationplandetailapp=angular.module("operationplandetailapp",["ngCookies","gettext","ngWebSocket","frepple.input","frepple.common"],["$locationProvider",function(a){a.html5Mode({enabled:!0,requireBase:!1})}]);operationplandetailapp.config(["$httpProvider",function(a){a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",a.defaults.xsrfCookieName="csrftoken",a.defaults.xsrfHeaderName="X-CSRFToken"}]),operationplandetailapp.run(["gettextCatalog",function(a){a.setCurrentLanguage(language)}]),operationplandetailapp.filter("formatdate",function(){return function(a){if("undefined"!=typeof a)return moment(a).format("YYYY-MM-DD HH:mm:ss")}}),angular.module("operationplandetailapp").controller("operationplandetailCtrl",operationplanCtrl),operationplanCtrl.$inject=["$scope","OperationPlan"],angular.module("operationplandetailapp").directive("showproblemspanelDrv",showproblemspanelDrv),showproblemspanelDrv.$inject=["$window"],angular.module("operationplandetailapp").directive("showresourcespanelDrv",showresourcespanelDrv),showresourcespanelDrv.$inject=["$window"],angular.module("operationplandetailapp").directive("showbufferspanelDrv",showbufferspanelDrv),showbufferspanelDrv.$inject=["$window"],angular.module("operationplandetailapp").directive("showoperationpeggingpanelDrv",showoperationpeggingpanelDrv),showoperationpeggingpanelDrv.$inject=["$window"],angular.module("operationplandetailapp").directive("showoperationplanDrv",showoperationplanDrv),showoperationplanDrv.$inject=["$window"];
//# sourceMappingURL=frepple-operationplandetail.min.js.map